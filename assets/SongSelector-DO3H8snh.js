import{c as A,J as ve,C as me,r as d,y as be,H as pe,a as j,p as fe,b as r,s as k,o as n,e as s,g as b,u as i,X,w as g,i as z,n as O,F as w,l as _,t as v,m as ge,j as Y,k as xe,x as Z}from"./index-Ckxzr6FO.js";import{g as he}from"./version-map-BNZS0BZM.js";import{S as ee}from"./search-CcaiWE8S.js";import{S as te,A as ye}from"./sliders-horizontal-C0u_JhkZ.js";import{L as ke}from"./loader-2-BHTmj0By.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=A("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=A("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=A("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=A("FolderOpenIcon",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=A("PenIcon",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=A("PlusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),H=ve({failedUrls:new Set}),se="/default_cover.jpg",Ce=m=>{m&&!H.failedUrls.has(m)&&H.failedUrls.add(m)},Se=m=>!m||H.failedUrls.has(m)?se:m,Ae={key:0,class:"fixed inset-0 z-50 flex items-end md:items-center justify-center md:p-4 bg-black/50 backdrop-blur-sm"},Me={class:"bg-white w-full md:max-w-4xl h-[90vh] md:h-[80vh] flex flex-col border-t-2 md:border-2 border-black md:shadow-hard rounded-t-xl md:rounded-xl overflow-hidden"},Ve={class:"p-3 md:p-4 border-b-2 border-black flex items-center justify-between bg-gray-50 shrink-0"},Ne={class:"p-3 md:p-4 border-b-2 border-black space-y-3 shrink-0 bg-gray-50 relative z-20"},De={class:"flex gap-2"},Ie={class:"relative flex-1"},Pe={class:"flex gap-2"},Ue={class:"flex-1 bg-gray-200 p-1 rounded-lg flex"},Le=["onClick"],je={key:0,class:"absolute top-full right-0 mt-2 w-full md:w-[480px] bg-white rounded-xl shadow-xl border-2 border-black p-4 z-50 max-h-[60vh] overflow-y-auto"},ze={class:"flex justify-between items-center mb-4 border-b border-gray-100 pb-2"},Oe={class:"font-bold text-lg flex items-center gap-2"},Re={class:"space-y-4"},$e={class:"space-y-1"},Ee={class:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide"},Fe=["onClick"],Be={class:"space-y-1"},He={class:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide"},Te=["onClick"],qe={class:"space-y-2"},Ge={class:"flex gap-2"},Je=["value"],Ke={key:0,class:"space-y-2"},Qe={class:"flex gap-2"},We=["value"],Xe={class:"flex flex-wrap gap-2 mt-2"},Ye=["value"],Ze={class:"text-xs font-bold text-gray-600"},et={class:"flex-1 overflow-y-auto p-2 md:p-4 bg-gray-100 relative"},tt={key:0,class:"absolute inset-0 flex flex-col items-center justify-center bg-gray-100/80 z-10"},st={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 md:gap-4"},lt=["onClick"],at=["src","onError"],ot={class:"flex-1 min-w-0"},rt={class:"font-bold truncate text-sm group-hover:text-maimai-purple transition-colors"},nt={class:"text-xs text-gray-500 truncate"},it={class:"text-xs font-mono bg-gray-100 inline-block px-1 rounded mt-1"},dt={key:1,class:"flex items-center justify-center gap-4 mt-6 pb-2"},ut=["disabled"],ct={class:"font-bold text-sm"},vt=["disabled"],mt={key:2,class:"h-full flex flex-col items-center justify-center text-gray-400 min-h-[200px]"},bt={key:0,class:"text-center px-4"},pt={key:0,class:"text-xs text-red-500 mt-2"},ft={key:1},B=24,At={__name:"SongSelector",props:{isOpen:Boolean,musicData:{type:Array,default:()=>[]}},emits:["close","select"],setup(m,{emit:le}){const R=m,T=le,c=me(),q=d(new Map);be(async()=>{c.token&&c.records.length===0&&!c.isLoading&&c.fetchProfile();try{q.value=await pe()}catch(l){console.error("Failed to load aliases",l)}});const M=d(""),p=d("all"),V=d("all"),N=d(!1),x=d(1),D=d("default"),$=d(!1),ae=[{label:"默认",value:"default"},{label:"ID",value:"id"},{label:"定数",value:"ds"},{label:"达成率",value:"achievement"}],I=d(""),P=d(""),C=d(-1),U=d(""),L=d(""),S=d(-1),h=d([]),G=["Basic","Advanced","Expert","Master","Re:Master"],oe=["SSS+","SSS","SS+","SS","S+","S","AAA","AA","A"],J=[{id:"all",name:"全部流派"},{id:"my-records",name:"我的记录"},{id:"舞萌",name:"舞萌",aliases:["maimai","舞萌"]},{id:"流行&动漫",name:"流行&动漫",aliases:["POPS & ANIME","流行&动漫"]},{id:"niconico & VOCALOID",name:"niconico & V家",aliases:["niconico & VOCALOID","niconico & V家"]},{id:"东方Project",name:"东方Project",aliases:["Touhou Project","东方Project"]},{id:"游戏&综合",name:"游戏&综合",aliases:["GAME & VARIETY","游戏&综合","游戏 & 综合","Game & Variety","其他游戏"]},{id:"音击&中二",name:"音击&中二",aliases:["ONGEKI & CHUNITHM","音击&中二","音击 & 中二","Ongeki & Chunithm","音击&中二节奏"]}],re=j(()=>{if(!R.musicData)return[];const l=new Set(R.musicData.map(e=>e.basic_info.from));return["all",...Array.from(l).sort()]}),E=j(()=>{if(!R.musicData)return[];let l=[...R.musicData];if(p.value==="my-records"){const e=new Set(c.records.map(t=>String(t.song_id)));l=l.filter(t=>e.has(String(t.id)))}else if(p.value!=="all"){const e=J.find(t=>t.id===p.value);e&&e.aliases?l=l.filter(t=>{const a=t.basic_info.genre.trim();return e.aliases.includes(a)}):l=l.filter(t=>t.basic_info.genre===p.value)}if(V.value!=="all"&&(l=l.filter(e=>e.basic_info.from===V.value)),M.value){const e=M.value.toLowerCase();l=l.filter(t=>{if(t.title.toLowerCase().includes(e)||t.id.toString().includes(e))return!0;const a=q.value.get(Number(t.id));return!!(a&&a.some(o=>o.toLowerCase().includes(e))||t.basic_info.artist.toLowerCase().includes(e)||t.charts&&t.charts.some(o=>o.charter.toLowerCase().includes(e)))})}if(I.value!==""||P.value!==""){const e=I.value===""?0:Number(I.value),t=P.value===""?99:Number(P.value);l=l.filter(a=>{if(C.value===-1)return a.ds.some(o=>o>=e&&o<=t);{const o=a.ds[C.value];return o!==void 0&&o>=e&&o<=t}})}if(U.value!==""||L.value!==""||h.value.length>0){const e=U.value===""?0:Number(U.value),t=L.value===""?101:Number(L.value);l=l.filter(a=>{const o=K.value.get(Number(a.id));if(!o)return!1;if(S.value===-1)return Object.values(o).some(u=>{const f=u.achievements>=e&&u.achievements<=t,y=h.value.length===0||h.value.includes(u.rate.toUpperCase().replace("P","+"));return f&&y});{const u=o[S.value];if(!u)return!1;const f=u.achievements>=e&&u.achievements<=t,y=h.value.length===0||h.value.includes(u.rate.toUpperCase().replace("P","+"));return f&&y}})}return l.sort((e,t)=>{let a,o;if(D.value==="id")a=Number(e.id),o=Number(t.id);else if(D.value==="ds"){const u=f=>C.value===-1?Math.max(...f.ds):f.ds[C.value]||0;a=u(e),o=u(t)}else if(D.value==="achievement"){const u=f=>{var Q;const y=K.value.get(Number(f.id));if(!y)return-1;if(S.value===-1){const W=Object.values(y).map(ce=>ce.achievements);return W.length?Math.max(...W):-1}return((Q=y[S.value])==null?void 0:Q.achievements)||-1};a=u(e),o=u(t)}else return 0;return a===o?Number(t.id)-Number(e.id):$.value?o-a:a-o}),l}),F=j(()=>Math.ceil(E.value.length/B)),ne=j(()=>{const l=(x.value-1)*B,e=l+B;return E.value.slice(l,e)});fe([M,p,V],()=>{x.value=1});const ie=l=>{const e=Z(l.id);return Se(e)},de=l=>{const e=Z(l.id);Ce(e)},ue=l=>{const e=c.records.filter(a=>a.song_id===l.id);let t=null;e.length>0&&(e.sort((a,o)=>o.achievements-a.achievements),t=e[0]),T("select",{...l,record:t}),T("close")},K=j(()=>{const l=new Map;return c.records&&c.records.forEach(e=>{const t=Number(e.song_id);l.has(t)||l.set(t,{}),l.get(t)[e.level_index]=e}),l});return(l,e)=>m.isOpen?(n(),r("div",Ae,[s("div",Me,[s("div",Ve,[e[14]||(e[14]=s("h3",{class:"font-bold text-lg"},"选择歌曲",-1)),s("button",{onClick:e[0]||(e[0]=t=>l.$emit("close")),class:"p-1 hover:bg-gray-200 rounded"},[b(i(X),{size:24})])]),s("div",Ne,[s("div",De,[s("div",Ie,[b(i(ee),{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),g(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>M.value=t),type:"text",class:"input-base pl-10 py-2 w-full",placeholder:"搜索曲名、别名、曲师、谱师...",autoFocus:""},null,512),[[z,M.value]])]),s("button",{onClick:e[2]||(e[2]=t=>N.value=!N.value),class:O(["btn-base px-3 flex items-center justify-center bg-white border-2 border-black rounded-lg",N.value?"bg-gray-200":""])},[b(i(te),{size:20})],2)]),s("div",Pe,[s("div",Ue,[(n(),r(w,null,_(ae,t=>s("button",{key:t.value,onClick:a=>D.value=t.value,class:O(["flex-1 px-2 py-1 text-xs font-bold rounded-md transition-all whitespace-nowrap",D.value===t.value?"bg-white shadow-sm text-black ring-1 ring-black/5":"text-gray-500 hover:text-gray-700 hover:bg-gray-300/50"])},v(t.label),11,Le)),64))]),s("button",{onClick:e[3]||(e[3]=t=>$.value=!$.value),class:"bg-gray-200 hover:bg-gray-300 border-2 border-transparent hover:border-gray-400 rounded-lg px-3 flex items-center justify-center transition-all"},[b(i(ye),{size:18,class:O([{"rotate-180":!$.value},"transition-transform text-gray-600"])},null,8,["class"])])]),N.value?(n(),r("div",je,[s("div",ze,[s("h3",Oe,[b(i(te),{size:20}),e[15]||(e[15]=ge(" 高级筛选 ",-1))]),s("button",{onClick:e[4]||(e[4]=t=>N.value=!1),class:"p-1 hover:bg-gray-100 rounded-full transition-colors"},[b(i(X),{size:20,class:"text-gray-500"})])]),s("div",Re,[s("div",$e,[e[16]||(e[16]=s("div",{class:"text-xs font-bold text-gray-500 ml-1"},"流派",-1)),s("div",Ee,[(n(),r(w,null,_(J,t=>s("button",{key:t.id,onClick:a=>p.value=t.id,class:O(["px-3 py-1 text-xs font-bold border-2 border-black rounded-full whitespace-nowrap transition-colors flex-shrink-0",p.value===t.id?"bg-pink-400 text-black":"bg-white hover:bg-gray-100"])},v(t.name),11,Fe)),64))])]),s("div",Be,[e[17]||(e[17]=s("div",{class:"text-xs font-bold text-gray-500 ml-1"},"版本",-1)),s("div",He,[(n(!0),r(w,null,_(re.value,t=>(n(),r("button",{key:t,onClick:a=>V.value=t,class:O(["px-3 py-1 text-xs font-bold border-2 border-black rounded-full whitespace-nowrap transition-colors flex-shrink-0",V.value===t?"bg-blue-400 text-black":"bg-white hover:bg-gray-100"])},v(t==="all"?"全部版本":i(he)(t)),11,Te))),128))])]),s("div",qe,[e[20]||(e[20]=s("div",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider"},"定数筛选",-1)),s("div",Ge,[g(s("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>C.value=t),class:"input-base w-24 text-sm px-2"},[e[18]||(e[18]=s("option",{value:-1},"任意难度",-1)),(n(),r(w,null,_(G,(t,a)=>s("option",{key:a,value:a},v(t),9,Je)),64))],512),[[Y,C.value]]),g(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>I.value=t),type:"number",placeholder:"Min",class:"input-base w-full text-sm",step:"0.1"},null,512),[[z,I.value]]),e[19]||(e[19]=s("span",{class:"self-center font-bold text-gray-400"},"-",-1)),g(s("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>P.value=t),type:"number",placeholder:"Max",class:"input-base w-full text-sm",step:"0.1"},null,512),[[z,P.value]])])]),i(c).isAuthenticated?(n(),r("div",Ke,[e[23]||(e[23]=s("div",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider"},"达成率筛选",-1)),s("div",Qe,[g(s("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>S.value=t),class:"input-base w-24 text-sm px-2"},[e[21]||(e[21]=s("option",{value:-1},"任意难度",-1)),(n(),r(w,null,_(G,(t,a)=>s("option",{key:a,value:a},v(t),9,We)),64))],512),[[Y,S.value]]),g(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>U.value=t),type:"number",placeholder:"Min %",class:"input-base w-full text-sm",step:"0.1"},null,512),[[z,U.value]]),e[22]||(e[22]=s("span",{class:"self-center font-bold text-gray-400"},"-",-1)),g(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>L.value=t),type:"number",placeholder:"Max %",class:"input-base w-full text-sm",step:"0.1"},null,512),[[z,L.value]])]),s("div",Xe,[(n(),r(w,null,_(oe,t=>s("label",{key:t,class:"flex items-center gap-1 cursor-pointer select-none bg-gray-50 px-2 py-1 rounded border border-gray-200 hover:bg-gray-100"},[g(s("input",{type:"checkbox",value:t,"onUpdate:modelValue":e[11]||(e[11]=a=>h.value=a),class:"w-3 h-3 rounded border-gray-400 text-maimai-blue focus:ring-maimai-blue"},null,8,Ye),[[xe,h.value]]),s("span",Ze,v(t),1)])),64))])])):k("",!0)])])):k("",!0)]),s("div",et,[i(c).isLoading?(n(),r("div",tt,[b(i(ke),{class:"animate-spin text-maimai-blue mb-2",size:32}),e[24]||(e[24]=s("p",{class:"text-sm font-bold text-gray-500"},"正在加载记录...",-1))])):k("",!0),s("div",st,[(n(!0),r(w,null,_(ne.value,t=>(n(),r("button",{key:t.id,onClick:a=>ue(t),class:"flex items-center gap-3 p-2 bg-white border-2 border-black rounded-lg active:scale-[0.98] md:hover:translate-x-1 md:hover:translate-y-1 md:hover:shadow-none md:shadow-hard-sm transition-all text-left group"},[s("img",{src:ie(t),onError:a=>de(t),class:"w-14 h-14 md:w-16 md:h-16 object-cover border-2 border-black rounded shrink-0",loading:"lazy",referrerpolicy:"no-referrer"},null,40,at),s("div",ot,[s("div",rt,v(t.title),1),s("div",nt,v(t.basic_info.artist),1),s("div",it,"ID: "+v(t.id),1)])],8,lt))),128))]),F.value>1?(n(),r("div",dt,[s("button",{onClick:e[12]||(e[12]=t=>x.value--),disabled:x.value===1,class:"p-2 rounded-lg border-2 border-black hover:bg-gray-200 disabled:opacity-50 disabled:hover:bg-transparent transition-colors"},[b(i(we),{size:20})],8,ut),s("span",ct," Page "+v(x.value)+" / "+v(F.value),1),s("button",{onClick:e[13]||(e[13]=t=>x.value++),disabled:x.value===F.value,class:"p-2 rounded-lg border-2 border-black hover:bg-gray-200 disabled:opacity-50 disabled:hover:bg-transparent transition-colors"},[b(i(_e),{size:20})],8,vt)])):k("",!0),E.value.length===0?(n(),r("div",mt,[b(i(ee),{size:48,class:"mb-4 opacity-20"}),p.value==="my-records"&&i(c).records.length===0?(n(),r("div",bt,[e[25]||(e[25]=s("p",{class:"font-bold text-gray-500 mb-1"},"暂无记录数据",-1)),e[26]||(e[26]=s("p",{class:"text-xs"},"请检查设置中的用户名/Token，或确认是否已在查分器公开数据。",-1)),i(c).error?(n(),r("p",pt,v(i(c).error),1)):k("",!0)])):(n(),r("p",ft,"没有找到相关歌曲"))])):k("",!0)])])])):k("",!0)}};export{wt as C,_t as F,Ct as P,At as _,St as a,Se as g,Ce as m};
