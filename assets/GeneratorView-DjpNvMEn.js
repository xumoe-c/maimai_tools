import{c as K,d as X,r as x,p as B,a as A,C as R,b as u,o as n,e,g as _,m as I,u as o,t as h,n as m,F as N,l as P,s as z,x as L,X as W,w as $,i as E,D as Y,y as q,z as H,f as F,h as M,v as U,j as Q}from"./index-Ckxzr6FO.js";import{m as Z,g as ee,F as J,C as te,P as le,a as se,_ as oe}from"./SongSelector-DO3H8snh.js";import{D as ae,t as ne}from"./index-TLWY2T1E.js";import{T as re}from"./trash-2-Cn2St70d.js";import{a as O,C as V}from"./chevron-up-D1p7lqPo.js";import"./version-map-BNZS0BZM.js";import"./search-CcaiWE8S.js";import"./sliders-horizontal-C0u_JhkZ.js";import"./loader-2-BHTmj0By.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=K("ImageIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),G=X("preference",()=>{const v=x([]),f=x(null),d={default:{name:"标准 12 格",config:{theme:"default",title:"Maimai 歌曲喜好表"},labels:["入坑曲","最喜欢","最近练习","最强","最弱","初鸟 (AP)","初FC","想要AP","想要FC","听不腻","推荐曲","随便填"]},simple9:{name:"九宫格",config:{theme:"default",title:"Maimai 九宫格"},labels:["入坑曲","最喜欢","最近练习","最强","最弱","初鸟 (AP)","想要AP","想要FC","推荐曲"]},top3:{name:"Top 3",config:{theme:"default",title:"我的 Top 3"},labels:["No.1","No.2","No.3"]}},b=()=>{const s=localStorage.getItem("preference_archives"),l=localStorage.getItem("preference_active_archive_id"),t=localStorage.getItem("generator_config"),c=localStorage.getItem("generator_cells");if(s)v.value=JSON.parse(s),f.value=l||(v.value.length>0?v.value[0].id:null);else if(c){const i=t?JSON.parse(t):d.default.config,j=JSON.parse(c),T={id:Date.now().toString(),name:"默认存档",config:i,cells:j,createdAt:Date.now(),updatedAt:Date.now()};v.value=[T],f.value=T.id}else y("默认存档","default")};B(v,s=>{localStorage.setItem("preference_archives",JSON.stringify(s))},{deep:!0}),B(f,s=>{s&&localStorage.setItem("preference_active_archive_id",s)});const a=A(()=>v.value.find(s=>s.id===f.value)||null),r=A(()=>{var s;return((s=a.value)==null?void 0:s.config)||{}}),w=A(()=>{var s;return((s=a.value)==null?void 0:s.cells)||[]}),y=(s,l="default")=>{const t=d[l]||d.default,c={id:Date.now().toString(),name:s||`存档 ${v.value.length+1}`,config:{...t.config},cells:t.labels.map(i=>({label:i,song:null})),createdAt:Date.now(),updatedAt:Date.now()};return v.value.push(c),f.value=c.id,c.id},k=s=>{v.value.find(l=>l.id===s)&&(f.value=s)},S=(s,l)=>{const t=v.value.find(c=>c.id===s);t&&(t.name=l,t.updatedAt=Date.now())},C=s=>{if(v.value.length<=1){alert("至少保留一个存档");return}const l=v.value.findIndex(t=>t.id===s);l!==-1&&(v.value.splice(l,1),f.value===s&&(f.value=v.value[0].id))},p=s=>{a.value&&(a.value.config={...a.value.config,...s},a.value.updatedAt=Date.now())},D=(s,l)=>{a.value&&a.value.cells[s]&&(a.value.cells[s].song=l,a.value.updatedAt=Date.now())},g=(s,l)=>{a.value&&a.value.cells[s]&&(a.value.cells[s].label=l,a.value.updatedAt=Date.now())};return b(),{archives:v,activeArchiveId:f,currentArchive:a,config:r,cells:w,PRESETS:d,createArchive:y,switchArchive:k,renameArchive:S,deleteArchive:C,updateConfig:p,updateCell:D,updateCellLabel:g}}),de={class:"flex flex-col items-center gap-4"},ce={class:"flex gap-2 w-full justify-end"},ue=["disabled"],ve={class:"border-2 border-black shadow-hard bg-gray-50 p-4 rounded-xl"},fe={class:"flex flex-col items-end gap-1"},be={class:"text-xl font-mono font-bold text-maimai-yellow drop-shadow-sm bg-black px-4 py-2 rounded-lg leading-normal"},ge={class:"flex-1 grid grid-cols-3 grid-rows-4 gap-6"},pe=["onClick"],me={key:0,class:"absolute inset-0 flex items-center justify-center opacity-20"},xe=["src","onError"],he={key:2,class:"absolute bottom-0 left-0 right-0 bg-black/80 px-3 py-3 text-white"},ye={class:"font-bold text-sm truncate mb-1"},ke={class:"flex justify-between items-center"},we={class:"text-[10px] opacity-80 truncate max-w-[60%] leading-normal"},_e={key:0,class:"text-xs font-mono text-maimai-yellow font-bold leading-normal"},Ce={__name:"PreferenceCanvas",props:{config:Object,cells:Array},emits:["cell-click"],setup(v,{emit:f}){const d=v,b=R(),a=x(null),r=x(!1),w=A(()=>d.cells),y=g=>{if(!g)return null;const s=L(g.id);return ee(s)},k=g=>{if(!g)return;const s=L(g.id);Z(s)},S=async()=>{if(a.value){r.value=!0;try{const g=await ne(a.value,{cacheBust:!0,pixelRatio:2,backgroundColor:"#ffffff"}),s=document.createElement("a");s.download=`maimai-preference-${new Date().getTime()}.png`,s.href=g,s.click()}catch(g){console.error("Export failed:",g),alert("导出图片失败，请重试")}finally{r.value=!1}}},C=A(()=>({default:"bg-white",dark:"bg-gray-900 text-white",pink:"bg-pink-50",blue:"bg-blue-50"})[d.config.theme]||"bg-white"),p=A(()=>d.config.theme==="dark"?"text-white":"text-black"),D=A(()=>d.config.theme==="dark"?"border-white":"border-black");return(g,s)=>(n(),u("div",de,[e("div",ce,[e("button",{onClick:S,disabled:r.value,class:"btn-base bg-maimai-green text-white flex items-center gap-2"},[_(o(ae),{size:18}),I(" "+h(r.value?"生成中...":"保存图片"),1)],8,ue)]),e("div",ve,[e("div",{ref_key:"canvasRef",ref:a,class:m(["w-[800px] aspect-[3/4] p-8 flex flex-col relative transition-colors duration-300",C.value])},[e("div",{class:m(["flex justify-between items-start mb-8 border-b-4 pb-4",D.value])},[e("div",null,[e("h1",{class:m(["text-4xl font-black tracking-tighter mb-2 whitespace-nowrap",p.value])},h(v.config.title||"Maimai歌曲喜好表"),3),e("div",{class:m(["text-sm opacity-60 font-bold",p.value])},"GENERATED BY MAIMAI TOOLS",2)]),e("div",fe,[e("div",{class:m(["text-2xl font-bold",p.value])},h(o(b).profile.nickname||"Player Name"),3),e("div",be," RATING: "+h(o(b).profile.rating||"00000"),1)])],2),e("div",ge,[(n(!0),u(N,null,P(w.value,(l,t)=>(n(),u("div",{key:t,class:"relative flex flex-col h-full group cursor-pointer",onClick:c=>g.$emit("cell-click",t)},[e("div",{class:m(["flex-1 border-2 rounded-xl overflow-hidden relative bg-gray-100 transition-all hover:shadow-hard-sm",[D.value,l.song?"":"hover:bg-gray-200"]])},[l.song?z("",!0):(n(),u("div",me,[_(o(ie),{size:48,class:m(p.value)},null,8,["class"])])),l.song?(n(),u("img",{key:1,src:y(l.song),onError:c=>k(l.song),class:"absolute inset-0 w-full h-full object-cover",crossorigin:"anonymous",referrerpolicy:"no-referrer"},null,40,xe)):z("",!0),l.song?(n(),u("div",he,[e("div",ye,h(l.song.title),1),e("div",ke,[e("div",we,h(l.song.basic_info.artist),1),l.song.record?(n(),u("div",_e,h(l.song.record.achievements.toFixed(4))+"% ",1)):z("",!0)])])):z("",!0)],2),e("div",{class:m(["mt-2 text-center font-bold text-lg",p.value])},h(l.label),3)],8,pe))),128))]),e("div",{class:m(["mt-4 text-center text-xs font-bold opacity-40",p.value])}," Created with Maimai Tools ",2)],2)])]))}},$e={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4"},Ae={class:"bg-white w-full max-w-md rounded-xl border-2 border-black shadow-[8px_8px_0px_0px_#000000] overflow-hidden flex flex-col max-h-[80vh]"},Se={class:"p-4 border-b-2 border-black flex justify-between items-center bg-maimai-purple text-white"},De={class:"text-xl font-black flex items-center gap-2"},Ie={class:"flex-1 overflow-y-auto p-4 space-y-3"},ze={class:"flex-1 min-w-0 mr-3"},Ee={key:0,class:"flex items-center gap-2"},Ne=["onClick"],Pe={class:"font-bold truncate flex items-center gap-2"},je={key:0,class:"text-xs bg-purple-600 text-white px-1.5 py-0.5 rounded"},Te={class:"text-xs text-gray-500 mt-0.5"},Fe={key:0,class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},Me=["onClick"],Ue=["onClick","disabled"],Oe={class:"p-4 border-t-2 border-black bg-gray-50"},Ve={key:0,class:"flex flex-col gap-3"},Be={class:"flex gap-2 overflow-x-auto pb-1"},Le=["onClick"],Re={class:"flex gap-2 mt-1"},Je={__name:"PreferenceArchiveManager",props:{isOpen:Boolean},emits:["close"],setup(v,{emit:f}){const d=f,b=G(),a=x(!1),r=x(""),w=x("default"),y=x(null),k=x(""),S=()=>{r.value.trim()&&(b.createArchive(r.value,w.value),r.value="",a.value=!1)},C=s=>{y.value=s.id,k.value=s.name},p=()=>{k.value.trim()&&b.renameArchive(y.value,k.value),y.value=null},D=s=>{confirm("确定要删除这个存档吗？此操作不可恢复。")&&b.deleteArchive(s)},g=s=>{b.switchArchive(s)};return(s,l)=>v.isOpen?(n(),u("div",$e,[e("div",Ae,[e("div",Se,[e("h2",De,[_(o(J),{size:24}),l[5]||(l[5]=I(" 喜好表存档 ",-1))]),e("button",{onClick:l[0]||(l[0]=t=>d("close")),class:"p-1 hover:bg-white/20 rounded transition-colors"},[_(o(W),{size:24})])]),e("div",Ie,[(n(!0),u(N,null,P(o(b).archives,t=>(n(),u("div",{key:t.id,class:m(["p-3 border-2 rounded-lg flex items-center justify-between group transition-all",o(b).activeArchiveId===t.id?"border-black bg-purple-50 shadow-[2px_2px_0px_0px_#000000]":"border-gray-200 hover:border-gray-400"])},[e("div",ze,[y.value===t.id?(n(),u("div",Ee,[$(e("input",{"onUpdate:modelValue":l[1]||(l[1]=c=>k.value=c),class:"w-full px-2 py-1 text-sm border border-black rounded",onKeyup:Y(p,["enter"]),autoFocus:""},null,544),[[E,k.value]]),e("button",{onClick:p,class:"text-green-600 hover:bg-green-100 p-1 rounded"},[_(o(te),{size:16})])])):(n(),u("div",{key:1,onClick:c=>g(t.id),class:"cursor-pointer"},[e("div",Pe,[I(h(t.name)+" ",1),o(b).activeArchiveId===t.id?(n(),u("span",je,"当前")):z("",!0)]),e("div",Te,h(t.cells.length)+" 格 • "+h(new Date(t.updatedAt).toLocaleDateString()),1)],8,Ne))]),y.value!==t.id?(n(),u("div",Fe,[e("button",{onClick:c=>C(t),class:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded",title:"重命名"},[_(o(le),{size:16})],8,Me),e("button",{onClick:c=>D(t.id),class:m(["p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded",{"cursor-not-allowed opacity-50":o(b).archives.length<=1}]),title:"删除",disabled:o(b).archives.length<=1},[_(o(re),{size:16})],10,Ue)])):z("",!0)],2))),128))]),e("div",Oe,[a.value?(n(),u("div",Ve,[$(e("input",{"onUpdate:modelValue":l[2]||(l[2]=t=>r.value=t),placeholder:"输入存档名称...",class:"w-full px-3 py-2 border-2 border-black rounded-lg text-sm",autoFocus:""},null,512),[[E,r.value]]),e("div",Be,[(n(!0),u(N,null,P(o(b).PRESETS,(t,c)=>(n(),u("button",{key:c,onClick:i=>w.value=c,class:m(["px-3 py-1.5 rounded border text-xs font-bold whitespace-nowrap transition-colors",w.value===c?"bg-purple-600 text-white border-black":"bg-white border-gray-300 text-gray-600 hover:border-gray-500"])},h(t.name),11,Le))),128))]),e("div",Re,[e("button",{onClick:S,class:"flex-1 px-3 py-2 bg-black text-white font-bold rounded-lg text-sm"},"确定创建"),e("button",{onClick:l[3]||(l[3]=t=>a.value=!1),class:"px-3 py-2 bg-gray-200 font-bold rounded-lg text-sm"},"取消")])])):(n(),u("button",{key:1,onClick:l[4]||(l[4]=t=>a.value=!0),class:"w-full py-2 border-2 border-dashed border-gray-400 rounded-lg text-gray-500 font-bold hover:border-black hover:text-black hover:bg-white transition-all flex items-center justify-center gap-2"},[_(o(se),{size:18}),l[6]||(l[6]=I(" 新建存档 ",-1))]))])])])):z("",!0)}},Ge={class:"h-[calc(100vh-80px)] flex flex-col gap-4 lg:gap-6"},Ke={class:"flex items-center justify-between flex-shrink-0"},Xe={class:"flex items-center gap-4"},We={class:"flex-1 flex flex-col lg:grid lg:grid-cols-12 gap-4 lg:gap-6 min-h-0 pb-4 lg:pb-0"},Ye={class:"lg:col-span-4 flex flex-col gap-6 flex-shrink-0 lg:h-full lg:overflow-y-auto pr-1"},qe={class:"bg-white border-2 border-black shadow-hard rounded-xl overflow-hidden flex flex-col"},He={class:"border-b-2 border-black last:border-0"},Qe={class:"p-4 border-t-2 border-black space-y-3 bg-white"},Ze={class:"border-b-2 border-black last:border-0"},et={class:"p-4 border-t-2 border-black space-y-3 bg-white"},tt=["value"],lt={class:"border-b-2 border-black last:border-0"},st={class:"p-4 border-t-2 border-black space-y-3 bg-white"},ot={class:"grid grid-cols-2 gap-2"},at=["value","onInput"],nt={class:"flex-1 lg:col-span-8 bg-gray-200 border-2 border-black shadow-hard rounded-xl relative min-h-0 overflow-hidden flex flex-col"},rt={class:"w-full h-full overflow-auto relative z-10 flex flex-col items-center"},it={class:"my-auto p-4 lg:p-8 origin-top lg:origin-center transform scale-[0.4] xs:scale-[0.45] sm:scale-[0.6] md:scale-[0.7] lg:scale-[0.8] xl:scale-[0.9] 2xl:scale-100 transition-transform"},xt={__name:"GeneratorView",setup(v){const f=R(),d=G(),b=x([]);x(!1);const a=x(!1),r=x("basic"),w=l=>{r.value===l?r.value=null:r.value=l},y=[{id:"default",name:"默认 (简约白)"},{id:"dark",name:"酷炫黑"},{id:"pink",name:"萌系粉"},{id:"blue",name:"清爽蓝"}],k=A({get:()=>d.config.title,set:l=>d.updateConfig({title:l})}),S=A({get:()=>d.config.theme,set:l=>d.updateConfig({theme:l})}),C=x(!1),p=x(-1),D=l=>{p.value=l,C.value=!0},g=l=>{p.value!==-1&&d.updateCell(p.value,l),C.value=!1,p.value=-1},s=(l,t)=>{d.updateCellLabel(l,t)};return q(async()=>{try{b.value=await H()}catch(l){console.error("Failed to load music data",l)}f.token&&!f.profile.nickname&&f.fetchProfile()}),(l,t)=>{var c;return n(),u("div",Ge,[e("div",Ke,[e("div",Xe,[t[10]||(t[10]=e("h1",{class:"text-xl lg:text-2xl font-black"},"生涯歌曲喜好表生成器",-1)),e("button",{onClick:t[0]||(t[0]=i=>a.value=!0),class:"flex items-center gap-2 px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-sm font-bold text-gray-700 transition-colors border border-gray-300"},[_(o(J),{size:16}),I(" "+h(((c=o(d).currentArchive)==null?void 0:c.name)||"默认存档"),1)])]),t[11]||(t[11]=e("div",{class:"text-xs lg:text-sm font-bold bg-maimai-yellow px-2 lg:px-3 py-1 border-2 border-black rounded shadow-hard-sm"}," Beta ",-1))]),e("div",We,[e("div",Ye,[e("div",qe,[t[19]||(t[19]=e("div",{class:"p-4 border-b-2 border-black bg-gray-50"},[e("h2",{class:"font-bold text-lg"},"配置面板")],-1)),e("div",He,[e("button",{onClick:t[1]||(t[1]=i=>w("basic")),class:m(["w-full p-3 flex items-center justify-between hover:bg-gray-50 transition-colors",r.value==="basic"?"bg-gray-50":"bg-white"])},[t[12]||(t[12]=e("div",{class:"font-bold text-maimai-blue flex items-center gap-2"},[e("span",{class:"w-2 h-6 bg-maimai-blue rounded-full"}),I(" 基础信息 ")],-1)),(n(),F(M(r.value==="basic"?o(O):o(V)),{size:20}))],2),$(e("div",Qe,[e("div",null,[t[13]||(t[13]=e("label",{class:"block font-bold text-sm mb-1"},"玩家名称",-1)),$(e("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>o(f).profile.nickname=i),type:"text",class:"input-base",placeholder:"从水鱼查分器获取"},null,512),[[E,o(f).profile.nickname]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block font-bold text-sm mb-1"},"DX Rating",-1)),$(e("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>o(f).profile.rating=i),type:"number",class:"input-base",placeholder:"从水鱼查分器获取"},null,512),[[E,o(f).profile.rating]])])],512),[[U,r.value==="basic"]])]),e("div",Ze,[e("button",{onClick:t[4]||(t[4]=i=>w("theme")),class:m(["w-full p-3 flex items-center justify-between hover:bg-gray-50 transition-colors",r.value==="theme"?"bg-gray-50":"bg-white"])},[t[15]||(t[15]=e("div",{class:"font-bold text-maimai-yellow flex items-center gap-2"},[e("span",{class:"w-2 h-6 bg-maimai-yellow rounded-full"}),I(" 外观设置 ")],-1)),(n(),F(M(r.value==="theme"?o(O):o(V)),{size:20}))],2),$(e("div",et,[e("div",null,[t[16]||(t[16]=e("label",{class:"block font-bold text-sm mb-1"},"表格标题",-1)),$(e("input",{"onUpdate:modelValue":t[5]||(t[5]=i=>k.value=i),type:"text",class:"input-base",placeholder:"Maimai歌曲喜好表"},null,512),[[E,k.value]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block font-bold text-sm mb-1"},"主题风格",-1)),$(e("select",{"onUpdate:modelValue":t[6]||(t[6]=i=>S.value=i),class:"input-base"},[(n(),u(N,null,P(y,i=>e("option",{key:i.id,value:i.id},h(i.name),9,tt)),64))],512),[[Q,S.value]])])],512),[[U,r.value==="theme"]])]),e("div",lt,[e("button",{onClick:t[7]||(t[7]=i=>w("labels")),class:m(["w-full p-3 flex items-center justify-between hover:bg-gray-50 transition-colors",r.value==="labels"?"bg-gray-50":"bg-white"])},[t[18]||(t[18]=e("div",{class:"font-bold text-pink-400 flex items-center gap-2"},[e("span",{class:"w-2 h-6 bg-pink-400 rounded-full"}),I(" 格子标题 ")],-1)),(n(),F(M(r.value==="labels"?o(O):o(V)),{size:20}))],2),$(e("div",st,[e("div",ot,[(n(!0),u(N,null,P(o(d).cells,(i,j)=>(n(),u("div",{key:j},[e("input",{value:i.label,onInput:T=>s(j,T.target.value),type:"text",class:"input-base text-xs py-1 px-2"},null,40,at)]))),128))])],512),[[U,r.value==="labels"]])])])]),e("div",nt,[t[20]||(t[20]=e("div",{class:"absolute inset-0 opacity-10 pointer-events-none",style:{"background-image":"radial-gradient(#000 1px, transparent 1px)","background-size":"20px 20px"}},null,-1)),e("div",rt,[e("div",it,[_(Ce,{config:o(d).config,cells:o(d).cells,onCellClick:D},null,8,["config","cells"])])])])]),C.value?(n(),F(oe,{key:0,isOpen:!0,musicData:b.value,onSelect:g,onClose:t[8]||(t[8]=i=>C.value=!1)},null,8,["musicData"])):z("",!0),_(Je,{"is-open":a.value,onClose:t[9]||(t[9]=i=>a.value=!1)},null,8,["is-open"])])}}};export{xt as default};
