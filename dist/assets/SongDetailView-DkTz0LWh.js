import{c as _,C as K,I as X,r as m,a as q,y as Q,b as n,e,s as v,g as b,m as x,u as d,A as W,x as Y,t as a,K as F,L as G,F as T,l as D,n as I,N as J,M as Z,z as ee,O as te,P as se,Q as oe,o as r}from"./index-Ckxzr6FO.js";import{A as le}from"./arrow-left-JGhVexi9.js";import{L as ae}from"./loader-2-BHTmj0By.js";import{I as ne}from"./info-BPO-05x5.js";import{S as re}from"./search-CcaiWE8S.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=_("ActivityIcon",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=_("BarChart2Icon",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=_("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=_("UserIcon",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),ve={class:"max-w-5xl mx-auto pb-12 space-y-6"},be={key:0,class:"flex justify-center py-20"},fe={key:1,class:"space-y-8"},xe={class:"bg-white border-2 border-black shadow-hard rounded-xl overflow-hidden"},ge={class:"flex flex-col md:flex-row"},me={class:"w-full md:w-64 shrink-0 border-b-2 md:border-b-0 md:border-r-2 border-black relative group flex justify-center items-center md:block bg-gray-50 md:bg-transparent py-6 md:py-0"},pe={class:"w-48 md:w-full aspect-square relative shadow-hard md:shadow-none border-2 md:border-0 border-black"},he=["src"],ye={class:"p-6 flex-1 flex flex-col justify-between bg-gradient-to-br from-white to-gray-50"},ke={class:"flex items-start justify-between gap-4"},we={class:"inline-block px-2 py-0.5 text-xs font-black border border-black rounded bg-gray-100 mb-2"},_e={class:"text-gray-600 font-bold flex items-center gap-2"},Ce={class:"text-right shrink-0"},Me={class:"text-xl font-black"},ze={class:"mt-6 grid grid-cols-2 md:grid-cols-4 gap-4"},Ie={class:"bg-white p-3 rounded border-2 border-black/10"},Se={class:"text-lg font-black"},$e={class:"bg-white p-3 rounded border-2 border-black/10"},Le={class:"text-lg font-black truncate"},je={class:"text-sm font-bold truncate max-w-[200px]"},Ae={key:0,class:"text-gray-400 ml-1"},Be={class:"space-y-6"},Fe={class:"text-2xl font-black flex items-center gap-2"},Te={class:"flex flex-wrap gap-2"},De=["onClick"],Pe={class:"relative z-10"},Ee={key:0,class:"relative z-10 bg-white rounded px-1 flex items-center shadow-sm"},Re=["src"],Oe={class:"text-xs opacity-80 bg-black/20 px-1.5 py-0.5 rounded relative z-10"},Ue={key:0,class:"bg-white border-2 border-black shadow-hard rounded-xl overflow-hidden animate-in fade-in slide-in-from-bottom-4 duration-300"},Ne={class:"font-black text-white uppercase tracking-wider drop-shadow-md"},Ve={class:"font-black text-white text-xl drop-shadow-md"},He={class:"p-4 md:p-6 grid grid-cols-1 lg:grid-cols-2 gap-8"},Ke={class:"space-y-4"},Xe={class:"font-bold text-gray-900 flex items-center gap-2 border-b-2 border-black/5 pb-2"},qe={class:"grid grid-cols-2 gap-4 text-sm"},Qe=["title"],We={class:"font-bold block"},Ye={class:"font-bold block"},Ge={class:"font-bold block"},Je={key:0,class:"bg-gray-50 rounded border border-gray-200 p-3"},Ze={class:"grid grid-cols-5 gap-1 text-center"},et={class:"font-black text-sm"},tt={class:"font-black text-sm"},st={class:"font-black text-sm"},ot={class:"font-black text-sm"},lt={class:"font-black text-sm"},at={class:"space-y-4 relative"},nt={class:"font-bold text-gray-900 flex items-center gap-2 border-b-2 border-black/5 pb-2"},rt={key:0,class:"bg-gray-50 border-2 border-black/10 rounded-lg p-4 relative overflow-hidden"},it={class:"flex items-center justify-between relative z-10"},dt={class:"text-xs font-bold text-gray-400 mt-1"},ct={class:"flex gap-2 mt-3"},ut=["src"],vt=["src"],bt={class:"flex flex-col items-end"},ft=["src"],xt={class:"text-xs font-bold text-maimai-purple bg-white px-2 py-0.5 rounded border border-maimai-purple/20"},gt={key:1,class:"h-32 flex items-center justify-center bg-gray-50 border-2 border-dashed border-gray-200 rounded-lg text-gray-400 font-bold text-sm"},mt={key:2,class:"text-center py-20 font-bold text-gray-500"},pt={class:"bg-white border-2 border-black shadow-hard rounded-xl w-full max-w-sm p-6 animate-in fade-in zoom-in duration-200"},ht={class:"flex flex-wrap gap-2"},yt={key:0,class:"text-gray-500 text-sm"},kt={class:"flex flex-col"},$t={__name:"SongDetailView",setup(wt){const P=X(),E=W(),S=K(),p=P.params.id,l=m(null),h=m([]),f=m(null),C=m(!0),y=m(!1),o=m(0),g=m(!1),M=m({x:0,y:0});let k=null;const $=["bg-maimai-green","bg-maimai-yellow","bg-maimai-red","bg-maimai-purple","bg-pink-300"],L=["Basic","Advanced","Expert","Master","Re:Master"],c=q(()=>{if(!S.records.length)return[];const s=new Array(5).fill(null);return S.records.forEach(t=>{t.song_id==p&&(s[t.level_index]=t)}),s}),j=s=>{k=setTimeout(()=>{const t=s.touches?s.touches[0]:s,i=Math.min(t.clientX,window.innerWidth-180),u=Math.min(t.clientY,window.innerHeight-150);M.value={x:i,y:u},g.value=!0,navigator.vibrate&&navigator.vibrate(50)},500)},w=()=>{k&&(clearTimeout(k),k=null)},R=async()=>{try{await navigator.clipboard.writeText(l.value.title),g.value=!1}catch(s){console.error("Failed to copy:",s)}},O=()=>{const s=encodeURIComponent(l.value.title);if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){const i=Date.now();window.location.href=`bilibili://search?keyword=${s}`,setTimeout(()=>{Date.now()-i<2500&&!document.hidden&&window.open(`https://m.bilibili.com/search?keyword=${s}`,"_blank")},2e3)}else window.open(`https://search.bilibili.com/all?keyword=${s}`,"_blank");g.value=!1},U=()=>{const s=encodeURIComponent(l.value.title);if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){const i=Date.now();window.location.href=`orpheus://search?keyword=${s}`,setTimeout(()=>{Date.now()-i<2500&&!document.hidden&&window.open(`https://music.163.com/#/search/m/?s=${s}&type=1`,"_blank")},2e3)}else window.open(`https://music.163.com/#/search/m/?s=${s}&type=1`,"_blank");g.value=!1},N=async()=>{C.value=!0;try{if(await ee(),l.value=te(p),!l.value)return;h.value=await se(p);const s=await oe();s&&s.charts&&s.charts[p]&&(f.value=s.charts[p]),l.value.charts.length>3?o.value=3:o.value=l.value.charts.length-1}catch(s){console.error(s)}finally{C.value=!1}},V=s=>s>=100.5||s>=100?"text-maimai-yellow":s>=99.5||s>=99?"text-maimai-red":s>=98||s>=97?"text-maimai-blue":"text-gray-700",z=s=>s?`/maiFCFS/${s.rate.toLowerCase().replace("+","p")}.png`:null,A=s=>!s||!s.fc?null:`/maiFCFS/${s.fc.toLowerCase()}.png`,B=s=>!s||!s.fs?null:`/maiFCFS/${s.fs.toLowerCase()}.png`,H=s=>{s.target.src="/default_cover.jpg"};return Q(()=>{N()}),(s,t)=>(r(),n("div",ve,[e("button",{onClick:t[0]||(t[0]=i=>d(E).back()),class:"flex items-center gap-1 text-gray-500 font-bold hover:text-black transition-colors"},[b(d(le),{size:20}),t[7]||(t[7]=x(" 返回 ",-1))]),C.value?(r(),n("div",be,[b(d(ae),{class:"animate-spin text-maimai-blue",size:48})])):l.value?(r(),n("div",fe,[e("div",xe,[e("div",ge,[e("div",me,[e("div",pe,[e("img",{src:d(Y)(d(p)),onError:H,class:"w-full h-full object-cover"},null,40,he),t[8]||(t[8]=e("div",{class:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"},null,-1))])]),e("div",ye,[e("div",null,[e("div",ke,[e("div",null,[e("span",we,a(l.value.basic_info.genre),1),e("h1",{class:"text-2xl md:text-4xl font-black leading-tight mb-1 select-none cursor-pointer active:opacity-70 transition-opacity",onTouchstart:j,onTouchend:w,onTouchmove:w,onMousedown:j,onMouseup:w,onMouseleave:w,onContextmenu:t[1]||(t[1]=F(()=>{},["prevent"]))},a(l.value.title),33),e("p",_e,[b(d(ue),{size:16}),x(" "+a(l.value.basic_info.artist),1)])]),e("div",Ce,[t[9]||(t[9]=e("div",{class:"text-xs font-bold text-gray-400"},"ID",-1)),e("div",Me,a(d(p)),1)])]),e("div",ze,[e("div",Ie,[t[10]||(t[10]=e("div",{class:"text-xs text-gray-500 font-bold mb-1"},"BPM",-1)),e("div",Se,a(l.value.basic_info.bpm),1)]),e("div",$e,[t[11]||(t[11]=e("div",{class:"text-xs text-gray-500 font-bold mb-1"},"版本",-1)),e("div",Le,a(l.value.basic_info.from),1)]),e("div",{class:"bg-white p-3 rounded border-2 border-black/10 col-span-2 md:col-span-2 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors",onClick:t[2]||(t[2]=i=>y.value=!0)},[e("div",null,[t[12]||(t[12]=e("div",{class:"text-xs text-gray-500 font-bold mb-1"},"别名",-1)),e("div",je,[x(a(h.value.length>0?h.value[0]:"暂无别名")+" ",1),h.value.length>1?(r(),n("span",Ae,"+"+a(h.value.length-1),1)):v("",!0)])]),b(d(G),{size:16,class:"text-gray-400"})])])])])])]),e("div",Be,[e("h2",Fe,[b(d(ie),{class:"text-maimai-blue"}),t[13]||(t[13]=x(" 谱面与成绩 ",-1))]),e("div",Te,[(r(!0),n(T,null,D(l.value.charts,(i,u)=>(r(),n("button",{key:u,onClick:_t=>o.value=u,class:I(["px-4 py-2 rounded-lg font-black text-sm transition-all border-2 border-black shadow-sm flex items-center gap-2 relative overflow-hidden",o.value===u?[$[u],"text-white scale-105 shadow-md"]:["bg-white text-gray-500 hover:bg-gray-50"]])},[e("span",Pe,a(L[u]),1),c.value[u]?(r(),n("div",Ee,[e("img",{src:z(c.value[u]),class:"h-4 w-auto object-contain"},null,8,Re)])):v("",!0),e("span",Oe,a(l.value.ds[u]),1)],10,De))),128))]),l.value.charts[o.value]?(r(),n("div",Ue,[e("div",{class:I([$[o.value],"px-4 py-2 border-b-2 border-black flex items-center justify-between"])},[e("span",Ne,a(L[o.value]),1),e("span",Ve,a(l.value.ds[o.value]),1)],2),e("div",He,[e("div",Ke,[e("h3",Xe,[b(d(ne),{size:18}),t[14]||(t[14]=x(" 谱面信息 ",-1))]),e("div",qe,[e("div",null,[t[15]||(t[15]=e("span",{class:"text-gray-500 font-bold block"},"谱师",-1)),e("span",{class:"font-bold truncate block",title:l.value.charts[o.value].charter},a(l.value.charts[o.value].charter),9,Qe)]),e("div",null,[t[16]||(t[16]=e("span",{class:"text-gray-500 font-bold block"},"拟合难度",-1)),e("span",We,a(f.value&&f.value[o.value]&&f.value[o.value].fit_diff?f.value[o.value].fit_diff.toFixed(2):"-"),1)]),e("div",null,[t[17]||(t[17]=e("span",{class:"text-gray-500 font-bold block"},"平均达成率",-1)),e("span",Ye,a(f.value&&f.value[o.value]&&f.value[o.value].avg?f.value[o.value].avg.toFixed(2)+"%":"-"),1)]),e("div",null,[t[18]||(t[18]=e("span",{class:"text-gray-500 font-bold block"},"总物量",-1)),e("span",Ge,a(l.value.charts[o.value].notes?l.value.charts[o.value].notes.reduce((i,u)=>i+u,0):"-"),1)])]),l.value.charts[o.value].notes?(r(),n("div",Je,[e("div",Ze,[e("div",null,[t[19]||(t[19]=e("div",{class:"text-[10px] font-bold text-gray-400"},"TAP",-1)),e("div",et,a(l.value.charts[o.value].notes[0]),1)]),e("div",null,[t[20]||(t[20]=e("div",{class:"text-[10px] font-bold text-gray-400"},"HOLD",-1)),e("div",tt,a(l.value.charts[o.value].notes[1]),1)]),e("div",null,[t[21]||(t[21]=e("div",{class:"text-[10px] font-bold text-gray-400"},"SLIDE",-1)),e("div",st,a(l.value.charts[o.value].notes[2]),1)]),e("div",null,[t[22]||(t[22]=e("div",{class:"text-[10px] font-bold text-gray-400"},"TOUCH",-1)),e("div",ot,a(l.value.charts[o.value].notes[3]||"-"),1)]),e("div",null,[t[23]||(t[23]=e("div",{class:"text-[10px] font-bold text-gray-400"},"BREAK",-1)),e("div",lt,a(l.value.charts[o.value].notes[4]),1)])])])):v("",!0)]),e("div",at,[e("h3",nt,[b(d(de),{size:18}),t[24]||(t[24]=x(" 我的成绩 ",-1))]),c.value[o.value]?(r(),n("div",rt,[e("div",it,[e("div",null,[e("div",{class:I(["text-3xl font-black leading-none drop-shadow-md",V(c.value[o.value].achievements)]),style:{"text-shadow":"1px 1px 0 #fff, -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff"}},a(c.value[o.value].achievements.toFixed(4))+"% ",3),e("div",dt," DX Score: "+a(c.value[o.value].dxScore),1),e("div",ct,[A(c.value[o.value])?(r(),n("img",{key:0,src:A(c.value[o.value]),class:"h-6 object-contain"},null,8,ut)):v("",!0),B(c.value[o.value])?(r(),n("img",{key:1,src:B(c.value[o.value]),class:"h-6 object-contain"},null,8,vt)):v("",!0)])]),e("div",bt,[z(c.value[o.value])?(r(),n("img",{key:0,src:z(c.value[o.value]),class:"h-12 object-contain drop-shadow-sm mb-1"},null,8,ft)):v("",!0),e("div",xt," Rating: "+a(c.value[o.value].ra),1)])])])):(r(),n("div",gt," 暂无成绩记录 "))])])])):v("",!0)])])):(r(),n("div",mt," 未找到乐曲信息 ")),y.value?(r(),n("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:t[4]||(t[4]=F(i=>y.value=!1,["self"]))},[e("div",pt,[t[25]||(t[25]=e("h3",{class:"text-xl font-black mb-4"},"乐曲别名",-1)),e("div",ht,[(r(!0),n(T,null,D(h.value,i=>(r(),n("span",{key:i,class:"px-3 py-1 bg-gray-100 border border-gray-300 rounded-full text-sm font-bold"},a(i),1))),128)),h.value.length===0?(r(),n("span",yt,"暂无别名数据")):v("",!0)]),e("button",{onClick:t[3]||(t[3]=i=>y.value=!1),class:"mt-6 w-full btn-base bg-black text-white py-2"},"关闭")])])):v("",!0),g.value?(r(),n("div",{key:4,class:"fixed z-50 bg-white border-2 border-black shadow-hard rounded-lg overflow-hidden min-w-[160px] animate-in fade-in zoom-in duration-200 origin-top-left",style:J({top:`${M.value.y}px`,left:`${M.value.x}px`})},[e("div",kt,[e("button",{onClick:R,class:"flex items-center gap-2 px-4 py-3 hover:bg-gray-100 text-sm font-bold text-left border-b border-gray-100 transition-colors"},[b(d(ce),{size:16}),t[26]||(t[26]=x(" 复制标题 ",-1))]),e("button",{onClick:O,class:"flex items-center gap-2 px-4 py-3 hover:bg-gray-100 text-sm font-bold text-left border-b border-gray-100 transition-colors"},[b(d(re),{size:16}),t[27]||(t[27]=x(" B站搜索 ",-1))]),e("button",{onClick:U,class:"flex items-center gap-2 px-4 py-3 hover:bg-gray-100 text-sm font-bold text-left transition-colors"},[b(d(Z),{size:16}),t[28]||(t[28]=x(" 网易云搜索 ",-1))])])],4)):v("",!0),g.value?(r(),n("div",{key:5,class:"fixed inset-0 z-40",onClick:t[5]||(t[5]=i=>g.value=!1),onTouchstart:t[6]||(t[6]=i=>g.value=!1)},null,32)):v("",!0)]))}};export{$t as default};
