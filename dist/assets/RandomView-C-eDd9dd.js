import{c as S,d as z,r as g,a as U,b as c,o as i,e,w,f as B,g as _,u as l,h as F,v as T,i as A,j as q,k as D,F as j,l as L,t as r,m as I,n as C,p as N,q as E,s as X,S as P,x as R,y as G,z as H,A as J,B as K}from"./index-BVpVXXB2.js";import{C as O,a as Q}from"./chevron-up-ClXRnAQE.js";import{A as W}from"./arrow-left-jOfwdKCj.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=S("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=S("FilterIcon",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=S("RotateCwIcon",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),V=z("random",()=>{const a=g({levelMin:1,levelMax:15,versions:[],genres:[],excludeUtage:!0,type:"ALL"}),f=g(null),s=g(!1),d=g([]);return{filters:a,currentResult:f,isRolling:s,history:d,updateFilters:b=>{a.value={...a.value,...b}},roll:async b=>{if(!b||b.length===0)return;s.value=!0,f.value=null;const p=b.filter(x=>a.value.genres.length>0&&!a.value.genres.includes(x.basic_info.genre)||a.value.versions.length>0&&!a.value.versions.includes(x.basic_info.from)||a.value.type!=="ALL"&&x.type!==a.value.type?!1:(a.value.excludeUtage,x.ds.some(M=>M>=a.value.levelMin&&M<=a.value.levelMax)));if(p.length===0){s.value=!1,alert("没有符合条件的歌曲");return}await new Promise(x=>setTimeout(x,800));const t=p[Math.floor(Math.random()*p.length)],o=[];t.ds.forEach((x,k)=>{x>=a.value.levelMin&&x<=a.value.levelMax&&o.push(k)});const m=o[Math.floor(Math.random()*o.length)],$={song:t,diffIndex:m,ds:t.ds[m],level:t.level[m],timestamp:Date.now()};f.value=$,d.value.unshift($),d.value.length>10&&d.value.pop(),s.value=!1}}}),te={class:"bg-white border-2 border-black shadow-hard rounded-xl p-6 flex flex-col gap-6 transition-all duration-300"},se={class:"flex items-center gap-2"},le={class:"flex flex-col gap-6 animate-in slide-in-from-top-2 duration-200"},oe={class:"space-y-2"},ae={class:"flex items-center gap-2"},ne={class:"space-y-2"},re={class:"flex gap-2"},ie={class:"flex items-center gap-2 mt-2"},de={class:"space-y-2"},ce={class:"h-32 overflow-y-auto border-2 border-black rounded p-2 bg-gray-50 grid grid-cols-1 gap-1"},ue=["value"],fe={class:"text-xs font-bold"},xe={class:"space-y-2"},pe={class:"h-32 overflow-y-auto border-2 border-black rounded p-2 bg-gray-50 grid grid-cols-1 gap-1"},ve=["value"],be={class:"text-xs font-bold"},me=["disabled"],ge={__name:"RandomConfig",props:{musicData:{type:Array,required:!0}},setup(a){const f=a,s=V(),d=g(!1),h=U(()=>{const p=new Set(f.musicData.map(t=>t.basic_info.genre));return Array.from(p).sort()}),n=U(()=>{const p=new Set(f.musicData.map(t=>t.basic_info.from));return Array.from(p).sort()}),b=()=>{s.roll(f.musicData)};return(p,t)=>(i(),c("div",te,[e("div",{class:"flex items-center justify-between border-b-2 border-black pb-4 cursor-pointer select-none",onClick:t[0]||(t[0]=o=>d.value=!d.value)},[e("div",se,[_(l(Z),{size:24}),t[7]||(t[7]=e("h2",{class:"text-xl font-black"},"筛选条件",-1))]),(i(),B(F(d.value?l(O):l(Q)),{size:24}))]),w(e("div",le,[e("div",oe,[t[9]||(t[9]=e("label",{class:"font-bold text-sm"},"定数范围 (1.0 - 15.0)",-1)),e("div",ae,[w(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>l(s).filters.levelMin=o),type:"number",step:"0.1",min:"1",max:"15",class:"w-full input-base text-center font-bold"},null,512),[[A,l(s).filters.levelMin,void 0,{number:!0}]]),t[8]||(t[8]=e("span",{class:"font-black"},"-",-1)),w(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>l(s).filters.levelMax=o),type:"number",step:"0.1",min:"1",max:"15",class:"w-full input-base text-center font-bold"},null,512),[[A,l(s).filters.levelMax,void 0,{number:!0}]])])]),e("div",ne,[t[12]||(t[12]=e("label",{class:"font-bold text-sm"},"谱面类型",-1)),e("div",re,[w(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>l(s).filters.type=o),class:"input-base flex-1"},[...t[10]||(t[10]=[e("option",{value:"ALL"},"全部 (DX & SD)",-1),e("option",{value:"DX"},"DX 谱面",-1),e("option",{value:"SD"},"标准谱面",-1)])],512),[[q,l(s).filters.type]])]),e("div",ie,[w(e("input",{id:"excludeUtage",type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=o=>l(s).filters.excludeUtage=o),class:"w-5 h-5 border-2 border-black rounded text-maimai-pink focus:ring-0"},null,512),[[D,l(s).filters.excludeUtage]]),t[11]||(t[11]=e("label",{for:"excludeUtage",class:"font-bold text-sm cursor-pointer select-none"}," 不包含宴会场 (Utage) ",-1))])]),e("div",de,[t[13]||(t[13]=e("label",{class:"font-bold text-sm"},"流派 (多选)",-1)),e("div",ce,[(i(!0),c(j,null,L(h.value,o=>(i(),c("label",{key:o,class:"flex items-center gap-2 cursor-pointer hover:bg-gray-200 p-1 rounded"},[w(e("input",{type:"checkbox",value:o,"onUpdate:modelValue":t[5]||(t[5]=m=>l(s).filters.genres=m),class:"border-2 border-black rounded text-maimai-blue"},null,8,ue),[[D,l(s).filters.genres]]),e("span",fe,r(o),1)]))),128))]),t[14]||(t[14]=e("div",{class:"text-xs text-gray-500 text-right"},"未选则默认全选",-1))]),e("div",xe,[t[15]||(t[15]=e("label",{class:"font-bold text-sm"},"版本 (多选)",-1)),e("div",pe,[(i(!0),c(j,null,L(n.value,o=>(i(),c("label",{key:o,class:"flex items-center gap-2 cursor-pointer hover:bg-gray-200 p-1 rounded"},[w(e("input",{type:"checkbox",value:o,"onUpdate:modelValue":t[6]||(t[6]=m=>l(s).filters.versions=m),class:"border-2 border-black rounded text-maimai-green"},null,8,ve),[[D,l(s).filters.versions]]),e("span",be,r(o),1)]))),128))]),t[16]||(t[16]=e("div",{class:"text-xs text-gray-500 text-right"},"未选则默认全选",-1))])],512),[[T,!d.value]]),e("button",{onClick:b,disabled:l(s).isRolling,class:"w-full py-4 bg-maimai-yellow border-2 border-black shadow-hard rounded-xl font-black text-xl flex items-center justify-center gap-2 hover:translate-y-1 hover:shadow-none transition-all disabled:opacity-50 disabled:cursor-not-allowed"},[_(l(ee),{class:C({"animate-spin":l(s).isRolling}),size:24},null,8,["class"]),I(" "+r(l(s).isRolling?"抽选中...":"开始随机"),1)],8,me)]))}},he={class:"flex flex-col gap-6 h-full"},ye={class:"flex-1 bg-white border-2 border-black shadow-hard rounded-xl p-6 flex flex-col items-center justify-center relative overflow-hidden min-h-[400px]"},_e={key:0,class:"flex flex-col items-center gap-4 animate-pulse"},we={class:"w-48 h-48 md:w-64 md:h-64 border-4 border-black rounded-xl overflow-hidden shadow-hard"},ke=["src"],$e={class:"text-2xl font-black text-center px-4 truncate max-w-full"},Me={key:1,class:"flex flex-col md:flex-row items-center md:items-start gap-6 w-full animate-in fade-in zoom-in duration-300"},Ce={class:"relative flex-shrink-0"},De={class:"absolute -top-6 -right-6 z-10"},Re={class:"w-48 h-48 md:w-64 md:h-64 border-4 border-black rounded-xl overflow-hidden shadow-hard relative group"},Ue=["src"],je={class:"absolute top-0 left-0 px-3 py-1 bg-black text-white font-black text-sm rounded-br-lg"},Le={class:"flex flex-col items-center md:items-start w-full gap-4"},Ie={class:"text-center md:text-left w-full"},Se={class:"text-2xl md:text-3xl font-black mb-2 leading-tight break-words"},Ae={class:"text-gray-500 font-bold break-words"},Ve={class:"flex flex-wrap justify-center md:justify-start items-center gap-4"},ze={class:"text-4xl font-black italic"},Be={class:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-4 w-full text-sm font-bold text-gray-600 bg-gray-50 p-4 rounded-lg border-2 border-black"},Fe={class:"flex justify-between items-center"},Te={class:"text-black text-right truncate"},qe={class:"flex justify-between items-center"},Ne={class:"text-black text-right truncate"},Ee={class:"flex justify-between items-center"},Xe={class:"text-black text-right truncate"},Pe={class:"flex justify-between items-center"},Ge={class:"text-black text-right truncate"},He={key:2,class:"text-center text-gray-400 flex flex-col items-center gap-4"},Je={key:0,class:"bg-white border-2 border-black shadow-hard rounded-xl p-4"},Ke={class:"flex items-center gap-2 mb-3 border-b-2 border-black pb-2"},Oe={class:"flex gap-3 overflow-x-auto pb-2"},Qe=["onClick"],We={class:"w-32 h-32 border-2 border-black rounded-lg overflow-hidden relative"},Ye=["src"],Ze={class:"text-xs font-bold truncate"},et={__name:"RandomResult",props:{musicData:{type:Array,required:!0}},setup(a){const f=a,s=V(),d=g(""),h=g("Ready?");let n=null;const b=()=>{f.musicData.length!==0&&(n=setInterval(()=>{const v=f.musicData[Math.floor(Math.random()*f.musicData.length)];d.value=R(v.id),h.value=v.title},80))},p=()=>{n&&(clearInterval(n),n=null)};N(()=>s.isRolling,v=>{v?b():p()}),E(()=>{p()});const t=U(()=>s.currentResult),o=["bg-maimai-green","bg-maimai-yellow","bg-maimai-red","bg-maimai-purple","bg-pink-300"],m=["Basic","Advanced","Expert","Master","Re:Master"],$=["text-maimai-green","text-maimai-yellow","text-maimai-red","text-maimai-purple","text-pink-500"],x=v=>o[v]||"bg-gray-400",k=v=>m[v]||"Unknown",M=v=>$[v]||"text-gray-600";return(v,u)=>(i(),c("div",he,[e("div",ye,[l(s).isRolling?(i(),c("div",_e,[e("div",we,[e("img",{src:d.value,class:"w-full h-full object-cover"},null,8,ke)]),e("div",$e,r(h.value),1),u[0]||(u[0]=e("div",{class:"text-maimai-blue font-bold text-lg"},"抽选中...",-1))])):t.value?(i(),c("div",Me,[e("div",Ce,[e("div",De,[_(l(P),{class:"text-maimai-yellow w-12 h-12 drop-shadow-md animate-bounce"})]),e("div",Re,[e("img",{src:l(R)(t.value.song.id),class:"w-full h-full object-cover"},null,8,Ue),e("div",je,r(t.value.song.type),1)])]),e("div",Le,[e("div",Ie,[e("h2",Se,r(t.value.song.title),1),e("p",Ae,r(t.value.song.basic_info.artist),1)]),e("div",Ve,[e("div",{class:C(["px-6 py-2 rounded-full border-2 border-black font-black text-xl text-white shadow-hard-sm whitespace-nowrap",x(t.value.diffIndex)])},r(k(t.value.diffIndex)),3),e("div",ze,r(t.value.level),1)]),e("div",Be,[e("div",Fe,[u[1]||(u[1]=e("span",{class:"whitespace-nowrap mr-2"},"定数:",-1)),e("span",Te,r(t.value.ds),1)]),e("div",qe,[u[2]||(u[2]=e("span",{class:"whitespace-nowrap mr-2"},"BPM:",-1)),e("span",Ne,r(t.value.song.basic_info.bpm),1)]),e("div",Ee,[u[3]||(u[3]=e("span",{class:"whitespace-nowrap mr-2"},"版本:",-1)),e("span",Xe,r(t.value.song.basic_info.from),1)]),e("div",Pe,[u[4]||(u[4]=e("span",{class:"whitespace-nowrap mr-2"},"流派:",-1)),e("span",Ge,r(t.value.song.basic_info.genre),1)])])])])):(i(),c("div",He,[...u[5]||(u[5]=[e("div",{class:"w-32 h-32 bg-gray-100 rounded-full flex items-center justify-center border-4 border-gray-200 border-dashed"},[e("span",{class:"text-4xl"},"?")],-1),e("p",{class:"font-bold text-xl"},"点击左侧按钮开始随机",-1)])]))]),l(s).history.length>0?(i(),c("div",Je,[e("div",Ke,[_(l(Y),{size:18}),u[6]||(u[6]=e("h3",{class:"font-black"},"历史记录",-1))]),e("div",Oe,[(i(!0),c(j,null,L(l(s).history,(y,dt)=>(i(),c("div",{key:y.timestamp,class:"flex-shrink-0 w-32 flex flex-col gap-1 cursor-pointer hover:opacity-80 transition-opacity",onClick:ct=>l(s).currentResult=y},[e("div",We,[e("img",{src:l(R)(y.song.id),class:"w-full h-full object-cover"},null,8,Ye),e("div",{class:C(["absolute bottom-0 left-0 right-0 h-1.5",x(y.diffIndex)])},null,2)]),e("div",Ze,r(y.song.title),1),e("div",{class:C(["text-xs font-black",M(y.diffIndex)])},r(k(y.diffIndex))+" "+r(y.level),3)],8,Qe))),128))])])):X("",!0)]))}},tt={class:"flex flex-col gap-4 h-full lg:h-[calc(100vh-80px)]"},st={class:"flex items-center justify-between flex-shrink-0 px-4 md:px-0"},lt={class:"flex items-center gap-4"},ot={class:"text-xl lg:text-2xl font-black flex items-center gap-2"},at={key:0,class:"flex-1 flex items-center justify-center"},nt={key:1,class:"flex-1 flex flex-col lg:flex-row gap-6 lg:overflow-hidden min-h-0 pb-4"},rt={class:"w-full lg:w-1/3 flex-shrink-0 lg:overflow-y-auto"},it={class:"flex-1 lg:overflow-y-auto min-h-[400px]"},pt={__name:"RandomView",setup(a){const f=J(),s=g([]),d=g(!0);return G(async()=>{try{s.value=await H()}catch(h){console.error("Failed to load music data",h)}finally{d.value=!1}}),(h,n)=>(i(),c("div",tt,[e("div",st,[e("div",lt,[e("button",{onClick:n[0]||(n[0]=b=>l(f).back()),class:"flex items-center gap-1 text-gray-500 font-bold hover:text-black transition-colors"},[_(l(W),{size:20}),n[1]||(n[1]=I(" 返回 ",-1))]),e("h1",ot,[_(l(K),{size:24}),n[2]||(n[2]=I(" 随机选曲 ",-1))])])]),d.value?(i(),c("div",at,[...n[3]||(n[3]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-black border-t-transparent"},null,-1)])])):(i(),c("div",nt,[e("div",rt,[_(ge,{"music-data":s.value},null,8,["music-data"])]),e("div",it,[_(et,{"music-data":s.value},null,8,["music-data"])])]))]))}};export{pt as default};
