import{c as G,r as _e,u as le,a as b,b as z,d,o as n,e,f as C,g as B,h as i,t as f,n as g,F as j,i as M,j as D,k as J,l as ve,m as Ce,w as ee,X as de,p as y,v as O,q as te,s as $e,x as Se,y as q,z as Y,A as K}from"./index-DDtBvkLk.js";import{D as Ae,t as De}from"./index-CTYz7VfE.js";import{S as ce,a as ue,A as Ie,g as Ue}from"./version-map-Cjgc-yKJ.js";import{L as Ve}from"./loader-2-Bl4-IzP_.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=G("ChevronDownIcon",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=G("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=G("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=G("ChevronUpIcon",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=G("ImageIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),se=_e({failedUrls:new Set}),be="/default_cover.jpg",fe=k=>{k&&!se.failedUrls.has(k)&&se.failedUrls.add(k)},me=k=>!k||se.failedUrls.has(k)?be:k,ze={class:"flex flex-col items-center gap-4"},Oe={class:"flex gap-2 w-full justify-end"},Ee=["disabled"],Le={class:"border-2 border-black shadow-hard bg-gray-50 p-4 rounded-xl"},Pe={class:"flex flex-col items-end gap-1"},Re={class:"text-xl font-mono font-bold text-maimai-yellow drop-shadow-sm bg-black px-4 py-2 rounded-lg leading-normal"},Fe={class:"flex-1 grid grid-cols-3 grid-rows-4 gap-6"},Te=["onClick"],Be={key:0,class:"absolute inset-0 flex items-center justify-center opacity-20"},Ge=["src","onError"],qe={key:2,class:"absolute bottom-0 left-0 right-0 bg-black/80 px-3 py-3 text-white"},Je={class:"font-bold text-sm truncate mb-1"},He={class:"flex justify-between items-center"},Xe={class:"text-[10px] opacity-80 truncate max-w-[60%] leading-normal"},Ye={key:0,class:"text-xs font-mono text-maimai-yellow font-bold leading-normal"},Ke={__name:"PreferenceCanvas",props:{config:Object,cells:Array},emits:["cell-click"],setup(k,{emit:U}){const $=k,E=le(),u=b(null),m=b(!1),I=z(()=>$.cells),S=x=>{if(!x)return null;const h=J(x.id);return me(h)},N=x=>{if(!x)return;const h=J(x.id);fe(h)},V=async()=>{if(u.value){m.value=!0;try{const x=await De(u.value,{cacheBust:!0,pixelRatio:2,backgroundColor:"#ffffff"}),h=document.createElement("a");h.download=`maimai-preference-${new Date().getTime()}.png`,h.href=x,h.click()}catch(x){console.error("Export failed:",x),alert("导出图片失败，请重试")}finally{m.value=!1}}},w=z(()=>({default:"bg-white",dark:"bg-gray-900 text-white",pink:"bg-pink-50",blue:"bg-blue-50"})[$.config.theme]||"bg-white"),p=z(()=>$.config.theme==="dark"?"text-white":"text-black"),A=z(()=>$.config.theme==="dark"?"border-white":"border-black");return(x,h)=>(n(),d("div",ze,[e("div",Oe,[e("button",{onClick:V,disabled:m.value,class:"btn-base bg-maimai-green text-white flex items-center gap-2"},[C(i(Ae),{size:18}),B(" "+f(m.value?"生成中...":"保存图片"),1)],8,Ee)]),e("div",Le,[e("div",{ref_key:"canvasRef",ref:u,class:g(["w-[800px] aspect-[3/4] p-8 flex flex-col relative transition-colors duration-300",w.value])},[e("div",{class:g(["flex justify-between items-start mb-8 border-b-4 pb-4",A.value])},[e("div",null,[e("h1",{class:g(["text-4xl font-black tracking-tighter mb-2 whitespace-nowrap",p.value])},f(k.config.title||"Maimai歌曲喜好表"),3),e("div",{class:g(["text-sm opacity-60 font-bold",p.value])},"GENERATED BY MAIMAI TOOLS",2)]),e("div",Pe,[e("div",{class:g(["text-2xl font-bold",p.value])},f(i(E).profile.nickname||"Player Name"),3),e("div",Re," RATING: "+f(i(E).profile.rating||"00000"),1)])],2),e("div",Fe,[(n(!0),d(j,null,M(I.value,(a,l)=>(n(),d("div",{key:l,class:"relative flex flex-col h-full group cursor-pointer",onClick:c=>x.$emit("cell-click",l)},[e("div",{class:g(["flex-1 border-2 rounded-xl overflow-hidden relative bg-gray-100 transition-all hover:shadow-hard-sm",[A.value,a.song?"":"hover:bg-gray-200"]])},[a.song?D("",!0):(n(),d("div",Be,[C(i(Ne),{size:48,class:g(p.value)},null,8,["class"])])),a.song?(n(),d("img",{key:1,src:S(a.song),onError:c=>N(a.song),class:"absolute inset-0 w-full h-full object-cover",crossorigin:"anonymous",referrerpolicy:"no-referrer"},null,40,Ge)):D("",!0),a.song?(n(),d("div",qe,[e("div",Je,f(a.song.title),1),e("div",He,[e("div",Xe,f(a.song.basic_info.artist),1),a.song.record?(n(),d("div",Ye,f(a.song.record.achievements.toFixed(4))+"% ",1)):D("",!0)])])):D("",!0)],2),e("div",{class:g(["mt-2 text-center font-bold text-lg",p.value])},f(a.label),3)],8,Te))),128))]),e("div",{class:g(["mt-4 text-center text-xs font-bold opacity-40",p.value])}," Created with Maimai Tools ",2)],2)])]))}},Qe={key:0,class:"fixed inset-0 z-50 flex items-end md:items-center justify-center md:p-4 bg-black/50 backdrop-blur-sm"},We={class:"bg-white w-full md:max-w-4xl h-[90vh] md:h-[80vh] flex flex-col border-t-2 md:border-2 border-black md:shadow-hard rounded-t-xl md:rounded-xl overflow-hidden"},Ze={class:"p-3 md:p-4 border-b-2 border-black flex items-center justify-between bg-gray-50 shrink-0"},et={class:"p-3 md:p-4 border-b-2 border-black space-y-3 shrink-0 bg-gray-50 relative z-20"},tt={class:"flex gap-2"},st={class:"relative flex-1"},lt={class:"flex gap-2"},ot={class:"flex-1 bg-gray-200 p-1 rounded-lg flex"},at=["onClick"],rt={key:0,class:"absolute top-full right-0 mt-2 w-full md:w-[480px] bg-white rounded-xl shadow-xl border-2 border-black p-4 z-50 max-h-[60vh] overflow-y-auto"},nt={class:"flex justify-between items-center mb-4 border-b border-gray-100 pb-2"},it={class:"font-bold text-lg flex items-center gap-2"},dt={class:"space-y-4"},ct={class:"space-y-1"},ut={class:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide"},bt=["onClick"],vt={class:"space-y-1"},ft={class:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide"},mt=["onClick"],pt={class:"space-y-2"},gt={class:"flex gap-2"},xt=["value"],ht={key:0,class:"space-y-2"},yt={class:"flex gap-2"},kt=["value"],wt={class:"flex flex-wrap gap-2 mt-2"},_t=["value"],Ct={class:"text-xs font-bold text-gray-600"},$t={class:"flex-1 overflow-y-auto p-2 md:p-4 bg-gray-100 relative"},St={key:0,class:"absolute inset-0 flex flex-col items-center justify-center bg-gray-100/80 z-10"},At={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 md:gap-4"},Dt=["onClick"],It=["src","onError"],Ut={class:"flex-1 min-w-0"},Vt={class:"font-bold truncate text-sm group-hover:text-maimai-purple transition-colors"},jt={class:"text-xs text-gray-500 truncate"},Mt={class:"text-xs font-mono bg-gray-100 inline-block px-1 rounded mt-1"},Nt={key:1,class:"flex items-center justify-center gap-4 mt-6 pb-2"},zt=["disabled"],Ot={class:"font-bold text-sm"},Et=["disabled"],Lt={key:2,class:"h-full flex flex-col items-center justify-center text-gray-400 min-h-[200px]"},Pt={key:0,class:"text-center px-4"},Rt={key:0,class:"text-xs text-red-500 mt-2"},Ft={key:1},Z=24,Tt={__name:"SongSelector",props:{isOpen:Boolean,musicData:{type:Array,default:()=>[]}},emits:["close","select"],setup(k,{emit:U}){const $=k,E=U,u=le(),m=b(new Map);ve(async()=>{u.token&&u.records.length===0&&!u.isLoading&&u.fetchProfile();try{m.value=await Ce()}catch(o){console.error("Failed to load aliases",o)}});const I=b(""),S=b("all"),N=b("all"),V=b(!1),w=b(1),p=b("default"),A=b(!1),x=[{label:"默认",value:"default"},{label:"ID",value:"id"},{label:"定数",value:"ds"},{label:"达成率",value:"achievement"}],h=b(""),a=b(""),l=b(-1),c=b(""),R=b(""),L=b(-1),F=b([]),oe=["Basic","Advanced","Expert","Master","Re:Master"],pe=["SSS+","SSS","SS+","SS","S+","S","AAA","AA","A"],ae=[{id:"all",name:"全部流派"},{id:"my-records",name:"我的记录"},{id:"舞萌",name:"舞萌",aliases:["maimai","舞萌"]},{id:"流行&动漫",name:"流行&动漫",aliases:["POPS & ANIME","流行&动漫"]},{id:"niconico & VOCALOID",name:"niconico & V家",aliases:["niconico & VOCALOID","niconico & V家"]},{id:"东方Project",name:"东方Project",aliases:["Touhou Project","东方Project"]},{id:"游戏&综合",name:"游戏&综合",aliases:["GAME & VARIETY","游戏&综合","游戏 & 综合","Game & Variety","其他游戏"]},{id:"音击&中二",name:"音击&中二",aliases:["ONGEKI & CHUNITHM","音击&中二","音击 & 中二","Ongeki & Chunithm","音击&中二节奏"]}],ge=z(()=>{if(!$.musicData)return[];const o=new Set($.musicData.map(t=>t.basic_info.from));return["all",...Array.from(o).sort()]}),H=z(()=>{if(!$.musicData)return[];let o=[...$.musicData];if(S.value==="my-records"){const t=new Set(u.records.map(s=>String(s.song_id)));o=o.filter(s=>t.has(String(s.id)))}else if(S.value!=="all"){const t=ae.find(s=>s.id===S.value);t&&t.aliases?o=o.filter(s=>{const r=s.basic_info.genre.trim();return t.aliases.includes(r)}):o=o.filter(s=>s.basic_info.genre===S.value)}if(N.value!=="all"&&(o=o.filter(t=>t.basic_info.from===N.value)),I.value){const t=I.value.toLowerCase();o=o.filter(s=>{if(s.title.toLowerCase().includes(t)||s.id.toString().includes(t))return!0;const r=m.value.get(Number(s.id));return!!(r&&r.some(v=>v.toLowerCase().includes(t))||s.basic_info.artist.toLowerCase().includes(t)||s.charts&&s.charts.some(v=>v.charter.toLowerCase().includes(t)))})}if(h.value!==""||a.value!==""){const t=h.value===""?0:Number(h.value),s=a.value===""?99:Number(a.value);o=o.filter(r=>{if(l.value===-1)return r.ds.some(v=>v>=t&&v<=s);{const v=r.ds[l.value];return v!==void 0&&v>=t&&v<=s}})}if(c.value!==""||R.value!==""||F.value.length>0){const t=c.value===""?0:Number(c.value),s=R.value===""?101:Number(R.value);o=o.filter(r=>{const v=re.value.get(Number(r.id));if(!v)return!1;if(L.value===-1)return Object.values(v).some(_=>{const P=_.achievements>=t&&_.achievements<=s,T=F.value.length===0||F.value.includes(_.rate.toUpperCase().replace("P","+"));return P&&T});{const _=v[L.value];if(!_)return!1;const P=_.achievements>=t&&_.achievements<=s,T=F.value.length===0||F.value.includes(_.rate.toUpperCase().replace("P","+"));return P&&T}})}return o.sort((t,s)=>{let r,v;if(p.value==="id")r=Number(t.id),v=Number(s.id);else if(p.value==="ds"){const _=P=>l.value===-1?Math.max(...P.ds):P.ds[l.value]||0;r=_(t),v=_(s)}else if(p.value==="achievement"){const _=P=>{var ne;const T=re.value.get(Number(P.id));if(!T)return-1;if(L.value===-1){const ie=Object.values(T).map(we=>we.achievements);return ie.length?Math.max(...ie):-1}return((ne=T[L.value])==null?void 0:ne.achievements)||-1};r=_(t),v=_(s)}else return 0;return r===v?Number(s.id)-Number(t.id):A.value?v-r:r-v}),o}),X=z(()=>Math.ceil(H.value.length/Z)),xe=z(()=>{const o=(w.value-1)*Z,t=o+Z;return H.value.slice(o,t)});ee([I,S,N],()=>{w.value=1});const he=o=>{const t=J(o.id);return me(t)},ye=o=>{const t=J(o.id);fe(t)},ke=o=>{const t=u.records.filter(r=>r.song_id===o.id);let s=null;t.length>0&&(t.sort((r,v)=>v.achievements-r.achievements),s=t[0]),E("select",{...o,record:s}),E("close")},re=z(()=>{const o=new Map;return u.records&&u.records.forEach(t=>{const s=Number(t.song_id);o.has(s)||o.set(s,{}),o.get(s)[t.level_index]=t}),o});return(o,t)=>k.isOpen?(n(),d("div",Qe,[e("div",We,[e("div",Ze,[t[14]||(t[14]=e("h3",{class:"font-bold text-lg"},"选择歌曲",-1)),e("button",{onClick:t[0]||(t[0]=s=>o.$emit("close")),class:"p-1 hover:bg-gray-200 rounded"},[C(i(de),{size:24})])]),e("div",et,[e("div",tt,[e("div",st,[C(i(ce),{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>I.value=s),type:"text",class:"input-base pl-10 py-2 w-full",placeholder:"搜索曲名、别名、曲师、谱师...",autoFocus:""},null,512),[[O,I.value]])]),e("button",{onClick:t[2]||(t[2]=s=>V.value=!V.value),class:g(["btn-base px-3 flex items-center justify-center bg-white border-2 border-black rounded-lg",V.value?"bg-gray-200":""])},[C(i(ue),{size:20})],2)]),e("div",lt,[e("div",ot,[(n(),d(j,null,M(x,s=>e("button",{key:s.value,onClick:r=>p.value=s.value,class:g(["flex-1 px-2 py-1 text-xs font-bold rounded-md transition-all whitespace-nowrap",p.value===s.value?"bg-white shadow-sm text-black ring-1 ring-black/5":"text-gray-500 hover:text-gray-700 hover:bg-gray-300/50"])},f(s.label),11,at)),64))]),e("button",{onClick:t[3]||(t[3]=s=>A.value=!A.value),class:"bg-gray-200 hover:bg-gray-300 border-2 border-transparent hover:border-gray-400 rounded-lg px-3 flex items-center justify-center transition-all"},[C(i(Ie),{size:18,class:g([{"rotate-180":!A.value},"transition-transform text-gray-600"])},null,8,["class"])])]),V.value?(n(),d("div",rt,[e("div",nt,[e("h3",it,[C(i(ue),{size:20}),t[15]||(t[15]=B(" 高级筛选 ",-1))]),e("button",{onClick:t[4]||(t[4]=s=>V.value=!1),class:"p-1 hover:bg-gray-100 rounded-full transition-colors"},[C(i(de),{size:20,class:"text-gray-500"})])]),e("div",dt,[e("div",ct,[t[16]||(t[16]=e("div",{class:"text-xs font-bold text-gray-500 ml-1"},"流派",-1)),e("div",ut,[(n(),d(j,null,M(ae,s=>e("button",{key:s.id,onClick:r=>S.value=s.id,class:g(["px-3 py-1 text-xs font-bold border-2 border-black rounded-full whitespace-nowrap transition-colors flex-shrink-0",S.value===s.id?"bg-pink-400 text-black":"bg-white hover:bg-gray-100"])},f(s.name),11,bt)),64))])]),e("div",vt,[t[17]||(t[17]=e("div",{class:"text-xs font-bold text-gray-500 ml-1"},"版本",-1)),e("div",ft,[(n(!0),d(j,null,M(ge.value,s=>(n(),d("button",{key:s,onClick:r=>N.value=s,class:g(["px-3 py-1 text-xs font-bold border-2 border-black rounded-full whitespace-nowrap transition-colors flex-shrink-0",N.value===s?"bg-blue-400 text-black":"bg-white hover:bg-gray-100"])},f(s==="all"?"全部版本":i(Ue)(s)),11,mt))),128))])]),e("div",pt,[t[20]||(t[20]=e("div",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider"},"定数筛选",-1)),e("div",gt,[y(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.value=s),class:"input-base w-24 text-sm px-2"},[t[18]||(t[18]=e("option",{value:-1},"任意难度",-1)),(n(),d(j,null,M(oe,(s,r)=>e("option",{key:r,value:r},f(s),9,xt)),64))],512),[[te,l.value]]),y(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>h.value=s),type:"number",placeholder:"Min",class:"input-base w-full text-sm",step:"0.1"},null,512),[[O,h.value]]),t[19]||(t[19]=e("span",{class:"self-center font-bold text-gray-400"},"-",-1)),y(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>a.value=s),type:"number",placeholder:"Max",class:"input-base w-full text-sm",step:"0.1"},null,512),[[O,a.value]])])]),i(u).isAuthenticated?(n(),d("div",ht,[t[23]||(t[23]=e("div",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider"},"达成率筛选",-1)),e("div",yt,[y(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>L.value=s),class:"input-base w-24 text-sm px-2"},[t[21]||(t[21]=e("option",{value:-1},"任意难度",-1)),(n(),d(j,null,M(oe,(s,r)=>e("option",{key:r,value:r},f(s),9,kt)),64))],512),[[te,L.value]]),y(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>c.value=s),type:"number",placeholder:"Min %",class:"input-base w-full text-sm",step:"0.1"},null,512),[[O,c.value]]),t[22]||(t[22]=e("span",{class:"self-center font-bold text-gray-400"},"-",-1)),y(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>R.value=s),type:"number",placeholder:"Max %",class:"input-base w-full text-sm",step:"0.1"},null,512),[[O,R.value]])]),e("div",wt,[(n(),d(j,null,M(pe,s=>e("label",{key:s,class:"flex items-center gap-1 cursor-pointer select-none bg-gray-50 px-2 py-1 rounded border border-gray-200 hover:bg-gray-100"},[y(e("input",{type:"checkbox",value:s,"onUpdate:modelValue":t[11]||(t[11]=r=>F.value=r),class:"w-3 h-3 rounded border-gray-400 text-maimai-blue focus:ring-maimai-blue"},null,8,_t),[[$e,F.value]]),e("span",Ct,f(s),1)])),64))])])):D("",!0)])])):D("",!0)]),e("div",$t,[i(u).isLoading?(n(),d("div",St,[C(i(Ve),{class:"animate-spin text-maimai-blue mb-2",size:32}),t[24]||(t[24]=e("p",{class:"text-sm font-bold text-gray-500"},"正在加载记录...",-1))])):D("",!0),e("div",At,[(n(!0),d(j,null,M(xe.value,s=>(n(),d("button",{key:s.id,onClick:r=>ke(s),class:"flex items-center gap-3 p-2 bg-white border-2 border-black rounded-lg active:scale-[0.98] md:hover:translate-x-1 md:hover:translate-y-1 md:hover:shadow-none md:shadow-hard-sm transition-all text-left group"},[e("img",{src:he(s),onError:r=>ye(s),class:"w-14 h-14 md:w-16 md:h-16 object-cover border-2 border-black rounded shrink-0",loading:"lazy",referrerpolicy:"no-referrer"},null,40,It),e("div",Ut,[e("div",Vt,f(s.title),1),e("div",jt,f(s.basic_info.artist),1),e("div",Mt,"ID: "+f(s.id),1)])],8,Dt))),128))]),X.value>1?(n(),d("div",Nt,[e("button",{onClick:t[12]||(t[12]=s=>w.value--),disabled:w.value===1,class:"p-2 rounded-lg border-2 border-black hover:bg-gray-200 disabled:opacity-50 disabled:hover:bg-transparent transition-colors"},[C(i(je),{size:20})],8,zt),e("span",Ot," Page "+f(w.value)+" / "+f(X.value),1),e("button",{onClick:t[13]||(t[13]=s=>w.value++),disabled:w.value===X.value,class:"p-2 rounded-lg border-2 border-black hover:bg-gray-200 disabled:opacity-50 disabled:hover:bg-transparent transition-colors"},[C(i(Me),{size:20})],8,Et)])):D("",!0),H.value.length===0?(n(),d("div",Lt,[C(i(ce),{size:48,class:"mb-4 opacity-20"}),S.value==="my-records"&&i(u).records.length===0?(n(),d("div",Pt,[t[25]||(t[25]=e("p",{class:"font-bold text-gray-500 mb-1"},"暂无记录数据",-1)),t[26]||(t[26]=e("p",{class:"text-xs"},"请检查设置中的用户名/Token，或确认是否已在查分器公开数据。",-1)),i(u).error?(n(),d("p",Rt,f(i(u).error),1)):D("",!0)])):(n(),d("p",Ft,"没有找到相关歌曲"))])):D("",!0)])])])):D("",!0)}},Bt={class:"h-[calc(100vh-80px)] flex flex-col gap-4 lg:gap-6"},Gt={class:"flex-1 flex flex-col lg:grid lg:grid-cols-12 gap-4 lg:gap-6 min-h-0 pb-4 lg:pb-0"},qt={class:"lg:col-span-4 flex flex-col gap-6 flex-shrink-0 lg:h-full lg:overflow-y-auto pr-1"},Jt={class:"bg-white border-2 border-black shadow-hard rounded-xl overflow-hidden flex flex-col"},Ht={class:"border-b-2 border-black last:border-0"},Xt={class:"p-4 border-t-2 border-black space-y-3 bg-white"},Yt={class:"border-b-2 border-black last:border-0"},Kt={class:"p-4 border-t-2 border-black space-y-3 bg-white"},Qt=["value"],Wt={class:"border-b-2 border-black last:border-0"},Zt={class:"p-4 border-t-2 border-black space-y-3 bg-white"},es={class:"grid grid-cols-2 gap-2"},ts=["onUpdate:modelValue"],ss={class:"flex-1 lg:col-span-8 bg-gray-200 border-2 border-black shadow-hard rounded-xl relative min-h-0 overflow-hidden flex flex-col"},ls={class:"w-full h-full overflow-auto relative z-10 flex flex-col items-center"},os={class:"my-auto p-4 lg:p-8 origin-top lg:origin-center transform scale-[0.4] xs:scale-[0.45] sm:scale-[0.6] md:scale-[0.7] lg:scale-[0.8] xl:scale-[0.9] 2xl:scale-100 transition-transform"},ds={__name:"GeneratorView",setup(k){const U=le(),$=b([]),E=localStorage.getItem("generator_config"),u=b(E?JSON.parse(E):{theme:"default",title:"Maimai歌曲喜好表"});ee(u,a=>{localStorage.setItem("generator_config",JSON.stringify(a))},{deep:!0}),b(!1);const m=b("basic"),I=a=>{m.value===a?m.value=null:m.value=a},S=[{id:"default",name:"默认 (简约白)"},{id:"dark",name:"酷炫黑"},{id:"pink",name:"萌系粉"},{id:"blue",name:"清爽蓝"}],N=["入坑曲","最喜欢","最近练习","最强","最弱","初鸟 (AP)","初FC","想要AP","想要FC","听不腻","推荐曲","随便填"],V=localStorage.getItem("generator_cells"),w=b(V?JSON.parse(V):N.map(a=>({label:a,song:null})));ee(w,a=>{localStorage.setItem("generator_cells",JSON.stringify(a))},{deep:!0});const p=b(!1),A=b(-1),x=a=>{A.value=a,p.value=!0},h=a=>{A.value!==-1&&(w.value[A.value].song=a),p.value=!1,A.value=-1};return ve(async()=>{try{$.value=await Se()}catch(a){console.error("Failed to load music data",a)}U.token&&!U.profile.nickname&&U.fetchProfile()}),(a,l)=>(n(),d("div",Bt,[l[17]||(l[17]=e("div",{class:"flex items-center justify-between flex-shrink-0"},[e("h1",{class:"text-xl lg:text-2xl font-black"},"生涯歌曲喜好表生成器"),e("div",{class:"text-xs lg:text-sm font-bold bg-maimai-yellow px-2 lg:px-3 py-1 border-2 border-black rounded shadow-hard-sm"}," Beta ")],-1)),e("div",Gt,[e("div",qt,[e("div",Jt,[l[15]||(l[15]=e("div",{class:"p-4 border-b-2 border-black bg-gray-50"},[e("h2",{class:"font-bold text-lg"},"配置面板")],-1)),e("div",Ht,[e("button",{onClick:l[0]||(l[0]=c=>I("basic")),class:g(["w-full p-3 flex items-center justify-between hover:bg-gray-50 transition-colors",m.value==="basic"?"bg-gray-50":"bg-white"])},[l[8]||(l[8]=e("div",{class:"font-bold text-maimai-blue flex items-center gap-2"},[e("span",{class:"w-2 h-6 bg-maimai-blue rounded-full"}),B(" 基础信息 ")],-1)),(n(),q(Y(m.value==="basic"?i(W):i(Q)),{size:20}))],2),y(e("div",Xt,[e("div",null,[l[9]||(l[9]=e("label",{class:"block font-bold text-sm mb-1"},"玩家名称",-1)),y(e("input",{"onUpdate:modelValue":l[1]||(l[1]=c=>i(U).profile.nickname=c),type:"text",class:"input-base",placeholder:"从水鱼查分器获取"},null,512),[[O,i(U).profile.nickname]])]),e("div",null,[l[10]||(l[10]=e("label",{class:"block font-bold text-sm mb-1"},"DX Rating",-1)),y(e("input",{"onUpdate:modelValue":l[2]||(l[2]=c=>i(U).profile.rating=c),type:"number",class:"input-base",placeholder:"从水鱼查分器获取"},null,512),[[O,i(U).profile.rating]])])],512),[[K,m.value==="basic"]])]),e("div",Yt,[e("button",{onClick:l[3]||(l[3]=c=>I("theme")),class:g(["w-full p-3 flex items-center justify-between hover:bg-gray-50 transition-colors",m.value==="theme"?"bg-gray-50":"bg-white"])},[l[11]||(l[11]=e("div",{class:"font-bold text-maimai-yellow flex items-center gap-2"},[e("span",{class:"w-2 h-6 bg-maimai-yellow rounded-full"}),B(" 外观设置 ")],-1)),(n(),q(Y(m.value==="theme"?i(W):i(Q)),{size:20}))],2),y(e("div",Kt,[e("div",null,[l[12]||(l[12]=e("label",{class:"block font-bold text-sm mb-1"},"表格标题",-1)),y(e("input",{"onUpdate:modelValue":l[4]||(l[4]=c=>u.value.title=c),type:"text",class:"input-base",placeholder:"Maimai歌曲喜好表"},null,512),[[O,u.value.title]])]),e("div",null,[l[13]||(l[13]=e("label",{class:"block font-bold text-sm mb-1"},"主题风格",-1)),y(e("select",{"onUpdate:modelValue":l[5]||(l[5]=c=>u.value.theme=c),class:"input-base"},[(n(),d(j,null,M(S,c=>e("option",{key:c.id,value:c.id},f(c.name),9,Qt)),64))],512),[[te,u.value.theme]])])],512),[[K,m.value==="theme"]])]),e("div",Wt,[e("button",{onClick:l[6]||(l[6]=c=>I("labels")),class:g(["w-full p-3 flex items-center justify-between hover:bg-gray-50 transition-colors",m.value==="labels"?"bg-gray-50":"bg-white"])},[l[14]||(l[14]=e("div",{class:"font-bold text-pink-400 flex items-center gap-2"},[e("span",{class:"w-2 h-6 bg-pink-400 rounded-full"}),B(" 格子标题 ")],-1)),(n(),q(Y(m.value==="labels"?i(W):i(Q)),{size:20}))],2),y(e("div",Zt,[e("div",es,[(n(!0),d(j,null,M(w.value,(c,R)=>(n(),d("div",{key:R},[y(e("input",{"onUpdate:modelValue":L=>c.label=L,type:"text",class:"input-base text-xs py-1 px-2"},null,8,ts),[[O,c.label]])]))),128))])],512),[[K,m.value==="labels"]])])])]),e("div",ss,[l[16]||(l[16]=e("div",{class:"absolute inset-0 opacity-10 pointer-events-none",style:{"background-image":"radial-gradient(#000 1px, transparent 1px)","background-size":"20px 20px"}},null,-1)),e("div",ls,[e("div",os,[C(Ke,{config:u.value,cells:w.value,onCellClick:x},null,8,["config","cells"])])])])]),p.value?(n(),q(Tt,{key:0,isOpen:!0,musicData:$.value,onSelect:h,onClose:l[7]||(l[7]=c=>p.value=!1)},null,8,["musicData"])):D("",!0)]))}};export{ds as default};
