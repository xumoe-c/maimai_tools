import{c as C,C as _,r as x,p as $,y as A,b as d,e as t,m as l,s as y,n as z,w as R,i as L,u as o,f as p,g as b,G as j,t as v,o as r}from"./index-Ckxzr6FO.js";import{L as w}from"./loader-2-BHTmj0By.js";import{R as I}from"./refresh-cw-DhWnmlzn.js";import{T as h}from"./trash-2-Cn2St70d.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=C("AlertCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=C("CheckCircle2Icon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=C("LogOutIcon",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Q={class:"max-w-2xl mx-auto space-y-6"},U={class:"bg-white border-2 border-black shadow-hard rounded-xl p-6"},E={class:"space-y-4"},O={class:"space-y-4"},P={class:"flex gap-4 p-1 bg-gray-100 rounded-lg w-fit"},q={class:"flex gap-2"},F={class:"flex-1"},G=["disabled"],H={key:1},J={key:0,class:"flex justify-end"},K={href:"https://www.diving-fish.com/maimaidx/docs/docs/intro",target:"_blank",class:"text-xs font-bold text-maimai-blue hover:underline flex items-center gap-1"},W={key:1,class:"flex items-center gap-2 text-sm text-maimai-green font-bold p-2 bg-green-50 border-2 border-maimai-green rounded"},X={key:2,class:"flex items-center gap-2 text-sm text-maimai-red font-bold p-2 bg-red-50 border-2 border-maimai-red rounded"},Y={key:0,class:"mt-6 pt-6 border-t-2 border-black/10 border-dashed"},Z={class:"flex items-center justify-between bg-gray-50 p-3 border-2 border-black rounded"},ee={class:"font-black text-lg"},te={class:"text-xs font-bold text-maimai-blue"},se={class:"bg-white border-2 border-black shadow-hard rounded-xl p-6"},oe={class:"space-y-6"},re={class:"space-y-3"},ae={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},le=["disabled"],ne=["disabled"],ie={class:"space-y-3 pt-4 border-t-2 border-black/5 border-dashed"},de={class:"grid grid-cols-2 sm:grid-cols-4 gap-2"},fe={__name:"SettingsView",setup(be){const s=_(),c=x("idle"),u=x(""),f=x(!1),m=x(!1),g=x(null),n=x("token");s.token&&(s.token.length>32?n.value="token":n.value="username"),$(n,(a,e)=>{a!==e&&s.token}),A(()=>{!s.isAuthenticated&&g.value&&g.value.focus()});const T=async()=>{if(!s.token)return;c.value="idle",u.value="",await s.fetchProfile()?(c.value="success",u.value=`成功加载: ${s.profile.nickname}`):(c.value="error",u.value=s.error||"加载失败")},V=()=>{s.clearUser(),c.value="idle",u.value=""},M=async()=>{if(!s.isAuthenticated)return;f.value=!0;const a=await s.fetchProfile();alert(a?"成绩数据已更新":"更新失败: "+(s.error||"未知错误")),f.value=!1},S=async()=>{m.value=!0;const a=await s.refreshMusic();alert(a?"乐曲数据库已更新":"更新失败"),m.value=!1},k=a=>{confirm("确定要清除选定的缓存吗？")&&(s.clearCache(a),alert("缓存已清除"),(a==="all"||a==="records")&&(c.value="idle",u.value=""))};return(a,e)=>(r(),d("div",Q,[e[26]||(e[26]=t("h1",{class:"text-2xl font-black"},"设置 & 数据源",-1)),t("div",U,[e[14]||(e[14]=t("h2",{class:"font-bold text-xl mb-4 flex items-center gap-2"},[t("span",{class:"w-3 h-3 bg-maimai-purple border-2 border-black"}),l(" 数据源配置 (Diving Fish) ")],-1)),t("div",E,[e[13]||(e[13]=t("p",{class:"text-sm text-gray-600"}," 配置您的查分器 Token 或 用户名，以便在各个工具中自动获取您的玩家数据（昵称、Rating、成绩等）。 ",-1)),t("div",O,[e[9]||(e[9]=t("label",{class:"block text-xs font-bold text-gray-500"},"验证方式",-1)),t("div",P,[t("button",{onClick:e[0]||(e[0]=i=>n.value="username"),class:z(["px-4 py-1.5 text-sm font-bold rounded-md transition-all",n.value==="username"?"bg-white shadow-sm text-black":"text-gray-500 hover:text-gray-700"])}," 用户名 / QQ号 ",2),t("button",{onClick:e[1]||(e[1]=i=>n.value="token"),class:z(["px-4 py-1.5 text-sm font-bold rounded-md transition-all",n.value==="token"?"bg-white shadow-sm text-black":"text-gray-500 hover:text-gray-700"])}," Import Token ",2)]),t("div",q,[t("div",F,[n.value==="username"?R((r(),d("input",{key:0,"onUpdate:modelValue":e[2]||(e[2]=i=>o(s).token=i),type:"text",class:"input-base w-full",placeholder:"请输入查分器用户名或QQ号",ref_key:"tokenInputRef",ref:g},null,512)),[[L,o(s).token]]):R((r(),d("input",{key:1,"onUpdate:modelValue":e[3]||(e[3]=i=>o(s).token=i),type:"password",class:"input-base w-full",placeholder:"请输入查分器 Import Token",ref_key:"tokenInputRef",ref:g},null,512)),[[L,o(s).token]])]),t("button",{onClick:T,disabled:o(s).isLoading||!o(s).token,class:"btn-base bg-black text-white px-4 py-2 flex items-center justify-center min-w-[80px]"},[o(s).isLoading?(r(),p(o(w),{key:0,class:"animate-spin",size:20})):(r(),d("span",H,"验证并保存"))],8,G)]),n.value==="token"?(r(),d("div",J,[t("a",K,[b(o(j),{size:12}),e[8]||(e[8]=l(" 如何获取 Token? ",-1))])])):y("",!0),c.value==="success"?(r(),d("div",W,[b(o(D),{size:16}),l(" "+v(u.value),1)])):y("",!0),c.value==="error"?(r(),d("div",X,[b(o(B),{size:16}),l(" "+v(u.value),1)])):y("",!0),e[10]||(e[10]=t("p",{class:"text-xs text-gray-400 mt-2"}," * 凭证将存储在本地，仅用于获取您的数据。 ",-1))]),o(s).isAuthenticated?(r(),d("div",Y,[e[12]||(e[12]=t("h3",{class:"font-bold text-sm mb-3"},"当前已绑定用户",-1)),t("div",Z,[t("div",null,[t("div",ee,v(o(s).profile.nickname),1),t("div",te,"Rating: "+v(o(s).profile.rating),1)]),t("button",{onClick:V,class:"text-xs font-bold text-maimai-red hover:underline flex items-center gap-1"},[b(o(N),{size:14}),e[11]||(e[11]=l(" 清除数据 ",-1))])])])):y("",!0)])]),t("div",se,[e[25]||(e[25]=t("h2",{class:"font-bold text-xl mb-4 flex items-center gap-2"},[t("span",{class:"w-3 h-3 bg-maimai-blue border-2 border-black"}),l(" 数据管理 ")],-1)),t("div",oe,[t("div",re,[e[17]||(e[17]=t("h3",{class:"font-bold text-sm text-gray-700"},"数据更新",-1)),t("div",ae,[t("button",{onClick:M,disabled:!o(s).isAuthenticated||f.value,class:"btn-base bg-white text-black border-2 border-black px-4 py-3 flex items-center justify-center gap-2 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[f.value?(r(),p(o(w),{key:0,class:"animate-spin",size:18})):(r(),p(o(I),{key:1,size:18})),e[15]||(e[15]=t("span",null,"刷新成绩数据",-1))],8,le),t("button",{onClick:S,disabled:m.value,class:"btn-base bg-white text-black border-2 border-black px-4 py-3 flex items-center justify-center gap-2 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[m.value?(r(),p(o(w),{key:0,class:"animate-spin",size:18})):(r(),p(o(I),{key:1,size:18})),e[16]||(e[16]=t("span",null,"刷新乐曲数据库",-1))],8,ne)]),e[18]||(e[18]=t("p",{class:"text-xs text-gray-500"}," * 成绩数据仅在已绑定用户时可用。乐曲数据库包含所有歌曲的基础信息。 ",-1))]),t("div",ie,[e[23]||(e[23]=t("h3",{class:"font-bold text-sm text-gray-700"},"缓存清理",-1)),t("div",de,[t("button",{onClick:e[4]||(e[4]=i=>k("music")),class:"btn-base bg-gray-100 text-gray-700 border-2 border-transparent hover:border-black hover:bg-white px-2 py-2 text-xs font-bold flex flex-col items-center gap-1"},[b(o(h),{size:14}),e[19]||(e[19]=l(" 清除乐曲缓存 ",-1))]),t("button",{onClick:e[5]||(e[5]=i=>k("records")),class:"btn-base bg-gray-100 text-gray-700 border-2 border-transparent hover:border-black hover:bg-white px-2 py-2 text-xs font-bold flex flex-col items-center gap-1"},[b(o(h),{size:14}),e[20]||(e[20]=l(" 清除成绩缓存 ",-1))]),t("button",{onClick:e[6]||(e[6]=i=>k("other")),class:"btn-base bg-gray-100 text-gray-700 border-2 border-transparent hover:border-black hover:bg-white px-2 py-2 text-xs font-bold flex flex-col items-center gap-1"},[b(o(h),{size:14}),e[21]||(e[21]=l(" 清除其他缓存 ",-1))]),t("button",{onClick:e[7]||(e[7]=i=>k("all")),class:"btn-base bg-red-50 text-maimai-red border-2 border-transparent hover:border-maimai-red hover:bg-white px-2 py-2 text-xs font-bold flex flex-col items-center gap-1"},[b(o(h),{size:14}),e[22]||(e[22]=l(" 清除所有缓存 ",-1))])]),e[24]||(e[24]=t("p",{class:"text-xs text-gray-500"}," * 清除缓存后，下次使用相关功能时将重新从服务器获取数据。 ",-1))])])])]))}};export{fe as default};
