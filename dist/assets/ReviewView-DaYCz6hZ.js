import{c as V,d as X,r as h,p as U,a as F,b as x,o as v,F as I,l as D,n as $,g as p,u as i,e,t as b,x as M,X as O,m as k,K as W,w as E,i as q,E as Z,s as j,C as ee,f as z,D as T,y as te,z as se,A as le}from"./index-BVpVXXB2.js";import{P as Y,F as G,C as oe,a as K,_ as ae}from"./SongSelector-AVRcfvBq.js";import{T as N}from"./trash-2-TmagiLWM.js";import{t as ne,D as ie}from"./index-D_W1WrYU.js";import{A as re}from"./arrow-left-jOfwdKCj.js";import"./version-map-BNZS0BZM.js";import"./search-NAuKHgj0.js";import"./sliders-horizontal-CoHwN6z_.js";import"./loader-2-yR3RaBWB.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=V("LayoutGridIcon",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=V("LayoutListIcon",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=V("QuoteIcon",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=V("SaveIcon",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=V("StarIcon",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),H=X("review",()=>{const s=h([]),m=h(null),o=h("table");(()=>{const a=localStorage.getItem("review_archives"),y=localStorage.getItem("review_active_archive_id"),u=localStorage.getItem("review_list");if(a)s.value=JSON.parse(a),m.value=y||(s.value.length>0?s.value[0].id:null);else if(u){const r=JSON.parse(u),L={id:Date.now().toString(),name:"é»˜è®¤å­˜æ¡£",reviews:r,createdAt:Date.now(),updatedAt:Date.now()};s.value=[L],m.value=L.id}else{const r={id:Date.now().toString(),name:"é»˜è®¤å­˜æ¡£",reviews:[],createdAt:Date.now(),updatedAt:Date.now()};s.value=[r],m.value=r.id}})(),U(s,a=>{localStorage.setItem("review_archives",JSON.stringify(a))},{deep:!0}),U(m,a=>{a&&localStorage.setItem("review_active_archive_id",a)});const t=F(()=>s.value.find(a=>a.id===m.value)||null),l=F(()=>t.value?t.value.reviews:[]),d=a=>{const y={id:Date.now().toString(),name:a||`å­˜æ¡£ ${s.value.length+1}`,reviews:[],createdAt:Date.now(),updatedAt:Date.now()};return s.value.push(y),m.value=y.id,y.id},g=a=>{s.value.find(y=>y.id===a)&&(m.value=a)},n=(a,y)=>{const u=s.value.find(r=>r.id===a);u&&(u.name=y,u.updatedAt=Date.now())},f=a=>{if(s.value.length<=1){alert("è‡³å°‘ä¿ç•™ä¸€ä¸ªå­˜æ¡£");return}const y=s.value.findIndex(u=>u.id===a);y!==-1&&(s.value.splice(y,1),m.value===a&&(m.value=s.value[0].id))},w=()=>{t.value&&(t.value.updatedAt=Date.now())};return{archives:s,activeArchiveId:m,currentArchive:t,reviews:l,currentMode:o,createArchive:d,switchArchive:g,renameArchive:n,deleteArchive:f,addReview:a=>{t.value&&(a.id||(a.id=Date.now()),t.value.reviews.push(a),w())},removeReview:a=>{if(!t.value)return;const y=t.value.reviews.findIndex(u=>u.id===a);y!==-1&&(t.value.reviews.splice(y,1),w())},updateReview:(a,y)=>{if(!t.value)return;const u=t.value.reviews.findIndex(r=>r.id===a);u!==-1&&(t.value.reviews[u]={...t.value.reviews[u],...y},w())},clearReviews:()=>{t.value&&(t.value.reviews=[],w())}}}),be={class:"flex items-center gap-1"},xe=["onClick","disabled"],P={__name:"RatingInput",props:{modelValue:{type:Number,default:0},max:{type:Number,default:5},readonly:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:m}){const o=s,c=m,t=l=>{o.readonly||c("update:modelValue",l)};return(l,d)=>(v(),x("div",be,[(v(!0),x(I,null,D(s.max,g=>(v(),x("button",{key:g,type:"button",onClick:n=>t(g),class:$(["transition-transform",s.readonly?"cursor-default":"cursor-pointer hover:scale-110 active:scale-95"]),disabled:s.readonly},[p(i(J),{size:24,class:$(["transition-colors",g<=s.modelValue?"fill-maimai-yellow text-maimai-yellow":"text-gray-300"]),"stroke-width":"2.5"},null,8,["class"])],10,xe))),128))]))}},me={class:"flex flex-col gap-2"},pe={class:"flex gap-2"},ge=["onClick","disabled"],fe={class:"text-xl"},ye={class:"text-[10px] font-bold leading-none"},he={__name:"QualityInput",props:{modelValue:{type:Number,default:3},readonly:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:m}){const o=s,c=m,t=[{value:5,label:"å¤¯ (ç¥è°±)",icon:"ğŸ”¥",color:"bg-red-500 text-white"},{value:4,label:"å¥½è°±",icon:"ğŸ‘",color:"bg-orange-400 text-white"},{value:3,label:"ä¸€èˆ¬",icon:"ğŸ˜",color:"bg-yellow-400 text-black"},{value:2,label:"æœ‰ç‚¹æ‹‰",icon:"ğŸ‘",color:"bg-blue-400 text-white"},{value:1,label:"ä¾æ‰˜ç­”è¾©",icon:"ğŸ’©",color:"bg-gray-600 text-white"}],l=d=>{o.readonly||c("update:modelValue",d)};return(d,g)=>(v(),x("div",me,[e("div",pe,[(v(),x(I,null,D(t,n=>e("button",{key:n.value,type:"button",onClick:f=>l(n.value),disabled:s.readonly,class:$(["flex-1 py-2 px-1 rounded-lg border-2 transition-all flex flex-col items-center justify-center gap-1",s.modelValue===n.value?`${n.color} border-black shadow-[2px_2px_0px_0px_#000000] translate-x-[-1px] translate-y-[-1px]`:"bg-white border-gray-200 text-gray-400 hover:border-gray-400"])},[e("span",fe,b(n.icon),1),e("span",ye,b(n.label),1)],10,ge)),64))])]))}},we={class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200"},_e={class:"bg-white w-full max-w-lg rounded-xl border-2 border-black shadow-hard p-6 relative animate-in zoom-in-95 duration-200 max-h-[90vh] overflow-y-auto"},ke={class:"flex gap-4 mb-6"},$e=["src"],Re={class:"font-bold text-lg leading-tight mb-1"},Ae={class:"text-sm text-gray-500 mb-2"},Ce={class:"inline-block px-2 py-0.5 bg-gray-100 border border-gray-300 rounded text-xs font-bold text-gray-600"},Se={class:"text-right text-xs text-gray-400 mt-1"},Ie={class:"text-right text-xs text-gray-400 mt-1"},De={class:"pt-4 flex gap-3"},ze={type:"submit",class:"flex-1 btn-base bg-maimai-blue text-white py-2.5 flex items-center justify-center gap-2"},Le={__name:"ReviewForm",props:{song:{type:Object,required:!0},initialData:{type:Object,default:()=>({})}},emits:["save","cancel"],setup(s,{emit:m}){const o=s,c=m,t=h({starRating:o.initialData.starRating||5,qualityRating:o.initialData.qualityRating||3,oneLiner:o.initialData.oneLiner||"",comment:o.initialData.comment||""}),l=F(()=>o.song.cover?o.song.cover:M(o.song.id)),d=()=>{if(!t.value.oneLiner.trim()){alert("è¯·å¡«å†™ä¸€å¥è¯è¯„ä»·");return}c("save",{...o.song,...t.value,songId:o.song.id,title:o.song.title,type:o.song.type,level:o.song.level,levelIndex:o.song.level_index})};return(g,n)=>(v(),x("div",we,[e("div",_e,[e("button",{onClick:n[0]||(n[0]=f=>g.$emit("cancel")),class:"absolute top-4 right-4 p-1 hover:bg-gray-100 rounded-full transition-colors"},[p(i(O),{size:24,class:"text-gray-500"})]),n[11]||(n[11]=e("h2",{class:"text-xl font-black mb-6 flex items-center gap-2"},[e("span",{class:"w-2 h-6 bg-maimai-blue block"}),k(" è¯„ä»·è°±é¢ ")],-1)),e("div",ke,[e("img",{src:l.value,class:"w-24 h-24 object-cover border-2 border-black rounded-lg shadow-sm"},null,8,$e),e("div",null,[e("h3",Re,b(s.song.title),1),e("div",Ae,"ID: "+b(s.song.id),1),e("div",Ce,b(s.song.type)+" "+b(s.song.level),1)])]),e("form",{onSubmit:W(d,["prevent"]),class:"space-y-6"},[e("div",null,[n[6]||(n[6]=e("label",{class:"block text-sm font-bold text-gray-700 mb-2"},"æ¨èåº¦",-1)),p(P,{modelValue:t.value.starRating,"onUpdate:modelValue":n[1]||(n[1]=f=>t.value.starRating=f)},null,8,["modelValue"])]),e("div",null,[n[7]||(n[7]=e("label",{class:"block text-sm font-bold text-gray-700 mb-2"},"è°±é¢è´¨é‡",-1)),p(he,{modelValue:t.value.qualityRating,"onUpdate:modelValue":n[2]||(n[2]=f=>t.value.qualityRating=f)},null,8,["modelValue"])]),e("div",null,[n[8]||(n[8]=e("label",{class:"block text-sm font-bold text-gray-700 mb-2"},[k(" ä¸€å¥è¯è¯„ä»· "),e("span",{class:"text-red-500"},"*")],-1)),E(e("input",{"onUpdate:modelValue":n[3]||(n[3]=f=>t.value.oneLiner=f),type:"text",placeholder:"ä¾‹å¦‚ï¼šçˆ½å±€ï¼/ å°¾æ€å¤ªéš¾äº† / å»ºè®®æ‰‹å…ƒ",class:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-maimai-blue focus:outline-none font-medium",maxlength:"20"},null,512),[[q,t.value.oneLiner]]),e("div",Se,b(t.value.oneLiner.length)+"/20",1)]),e("div",null,[n[9]||(n[9]=e("label",{class:"block text-sm font-bold text-gray-700 mb-2"},"è¯¦ç»†çŸ­è¯„ (é€‰å¡«)",-1)),E(e("textarea",{"onUpdate:modelValue":n[4]||(n[4]=f=>t.value.comment=f),rows:"3",placeholder:"å±•å¼€è¯´è¯´...",class:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-maimai-blue focus:outline-none font-medium resize-none",maxlength:"100"},null,512),[[q,t.value.comment]]),e("div",Ie,b(t.value.comment.length)+"/100",1)]),e("div",De,[e("button",{type:"button",onClick:n[5]||(n[5]=f=>g.$emit("cancel")),class:"flex-1 btn-base bg-white border-gray-300 text-gray-600 py-2.5"}," å–æ¶ˆ "),e("button",ze,[p(i(ve),{size:18}),n[10]||(n[10]=k(" ä¿å­˜è¯„ä»· ",-1))])])],32)])]))}},je={class:"space-y-3"},Ve={class:"w-16 h-16 flex-shrink-0 border border-black rounded overflow-hidden bg-gray-100"},Me=["src"],Ee={class:"flex-1 min-w-0 flex flex-col justify-between py-0.5"},qe={class:"flex justify-between items-start"},Fe={class:"font-bold truncate text-sm"},Ne={class:"text-xs font-black px-1.5 py-0.5 bg-gray-100 rounded border border-gray-300 ml-2 flex-shrink-0"},Pe={class:"flex items-center gap-2 text-xs"},Ue={class:"text-base leading-none",title:"è°±é¢è´¨é‡"},Te={class:"text-xs text-gray-600 truncate font-medium"},Qe={class:"flex flex-col justify-between items-end opacity-0 group-hover:opacity-100 transition-opacity"},Be=["onClick"],Oe=["onClick"],Ye={__name:"ReviewList",props:{reviews:{type:Array,required:!0}},emits:["edit","delete"],setup(s,{emit:m}){const o=c=>({5:"ğŸ”¥",4:"ğŸ‘",3:"ğŸ˜",2:"ğŸ‘",1:"ğŸ’©"})[c]||"";return(c,t)=>(v(),x("div",je,[(v(!0),x(I,null,D(s.reviews,l=>(v(),x("div",{key:l.id,class:"bg-white border-2 border-black p-3 rounded-lg flex gap-3 shadow-sm hover:shadow-md transition-shadow group"},[e("div",Ve,[e("img",{src:i(M)(l.songId),class:"w-full h-full object-cover",loading:"lazy"},null,8,Me)]),e("div",Ee,[e("div",qe,[e("div",Fe,b(l.title),1),e("div",Ne,b(l.type),1)]),e("div",Pe,[p(P,{"model-value":l.starRating,max:5,readonly:"",class:"scale-75 origin-left"},null,8,["model-value"]),e("span",Ue,b(o(l.qualityRating)),1)]),e("div",Te,' "'+b(l.oneLiner)+'" ',1)]),e("div",Qe,[e("button",{onClick:d=>c.$emit("edit",l),class:"text-gray-400 hover:text-maimai-blue p-1"},[p(i(Y),{size:14})],8,Be),e("button",{onClick:d=>c.$emit("delete",l.id),class:"text-gray-400 hover:text-red-500 p-1"},[p(i(N),{size:14})],8,Oe)])]))),128))]))}},Ge={class:"bg-white p-8 w-[800px] min-h-[600px]"},Ke={class:"flex items-center justify-between mb-6 border-b-4 border-black pb-4"},Je={class:"text-gray-500 font-bold mt-1"},He={class:"border-2 border-black"},Xe={class:"p-2 flex items-center justify-center border-r border-black"},We=["src"],Ze={class:"p-2 flex flex-col justify-center border-r border-black min-w-0"},et={class:"font-bold text-sm truncate leading-tight mb-1"},tt={class:"flex items-center gap-2"},st={class:"text-[10px] font-black px-1.5 py-0.5 bg-gray-200 rounded border border-gray-400"},lt={class:"text-xs font-bold text-gray-600"},ot={class:"p-2 flex flex-col justify-center border-r border-black"},at={class:"p-2 flex items-center font-medium text-sm text-gray-800"},Q={__name:"TableTemplate",props:{reviews:{type:Array,required:!0},username:{type:String,default:"PLAYER"}},setup(s){const m=c=>({5:"ğŸ”¥ å¤¯",4:"ğŸ‘ å¥½è°±",3:"ğŸ˜ ä¸€èˆ¬",2:"ğŸ‘ æœ‰ç‚¹æ‹‰",1:"ğŸ’© ä¾æ‰˜ç­”è¾©"})[c]||"",o=c=>({5:"text-red-600",4:"text-orange-500",3:"text-yellow-600",2:"text-blue-500",1:"text-gray-600"})[c]||"text-black";return(c,t)=>(v(),x("div",Ge,[e("div",Ke,[e("div",null,[t[0]||(t[0]=e("h1",{class:"text-3xl font-black tracking-tighter"},"MAIMAI è°±é¢è¯„ä»·è¡¨",-1)),e("div",Je,"Review by "+b(s.username),1)]),t[1]||(t[1]=e("div",{class:"text-right"},[e("div",{class:"text-sm font-bold text-gray-400"},"Generated by"),e("div",{class:"text-xl font-black"},"Maimai Tools")],-1))]),e("div",He,[t[2]||(t[2]=Z('<div class="grid grid-cols-[80px_1fr_140px_1fr] bg-black text-white font-black text-sm"><div class="p-2 text-center">å°é¢</div><div class="p-2">æ›²å / éš¾åº¦</div><div class="p-2">è¯„åˆ†</div><div class="p-2">ä¸€å¥è¯è¯„ä»·</div></div>',1)),(v(!0),x(I,null,D(s.reviews,(l,d)=>(v(),x("div",{key:l.id,class:$(["grid grid-cols-[80px_1fr_140px_1fr] border-b border-black last:border-b-0",d%2===0?"bg-white":"bg-gray-50"])},[e("div",Xe,[e("img",{src:i(M)(l.songId),class:"w-14 h-14 object-cover border border-black",crossorigin:"anonymous"},null,8,We)]),e("div",Ze,[e("div",et,b(l.title),1),e("div",tt,[e("span",st,b(l.type),1),e("span",lt,b(l.level),1)])]),e("div",ot,[p(P,{"model-value":l.starRating,max:5,readonly:"",class:"scale-75 origin-left mb-1"},null,8,["model-value"]),e("div",{class:$(["text-xs font-black",o(l.qualityRating)])},b(m(l.qualityRating)),3)]),e("div",at,b(l.oneLiner),1)],2))),128))]),t[3]||(t[3]=e("div",{class:"mt-4 text-center text-gray-400 text-xs font-bold"}," Create your own at maimai-tools.vercel.app ",-1))]))}},nt={class:"bg-[#F5F5F5] p-8 w-[600px] min-h-[800px] flex flex-col gap-6"},it={class:"bg-white border-2 border-black p-4 rounded-xl shadow-[4px_4px_0px_0px_#000000] flex items-center justify-between"},rt={class:"flex items-center gap-3"},dt={class:"w-10 h-10 bg-maimai-blue rounded-full border-2 border-black flex items-center justify-center text-white font-black"},ct={class:"text-xs font-bold text-gray-500 mt-1"},ut={class:"px-3 py-1 bg-black text-white font-black text-sm rounded-full"},vt={class:"space-y-6"},bt={class:"flex h-32 border-b-2 border-black"},xt={class:"w-32 h-32 flex-shrink-0 border-r-2 border-black relative"},mt=["src"],pt={class:"absolute top-0 left-0 bg-black text-white text-[10px] font-bold px-1.5 py-0.5 rounded-br"},gt={class:"flex-1 p-3 flex flex-col justify-between bg-white relative overflow-hidden"},ft={class:"absolute -right-4 -bottom-4 text-9xl opacity-5 select-none pointer-events-none"},yt={class:"font-black text-lg leading-tight line-clamp-2 mb-1"},ht={class:"text-xs font-bold text-gray-500"},wt={class:"flex items-center gap-3 relative z-10"},_t={class:"flex gap-0.5"},kt={class:"p-4 bg-gray-50 relative"},$t={class:"relative z-10 pl-6"},Rt={class:"font-black text-lg text-gray-800 leading-tight mb-1"},At={key:0,class:"text-xs text-gray-500 font-medium mt-2 border-t border-gray-200 pt-2"},B={__name:"CardTemplate",props:{reviews:{type:Array,required:!0},username:{type:String,default:"PLAYER"}},setup(s){const m=t=>({5:"ç¥è°±",4:"å¥½è°±",3:"ä¸€èˆ¬",2:"æœ‰ç‚¹æ‹‰",1:"ä¾æ‰˜ç­”è¾©"})[t]||"",o=t=>({5:"ğŸ”¥",4:"ğŸ‘",3:"ğŸ˜",2:"ğŸ‘",1:"ğŸ’©"})[t]||"",c=t=>({5:"bg-red-500",4:"bg-orange-400",3:"bg-yellow-400",2:"bg-blue-400",1:"bg-gray-600"})[t]||"bg-black";return(t,l)=>(v(),x("div",nt,[e("div",it,[e("div",rt,[e("div",dt,b(s.username.charAt(0).toUpperCase()),1),e("div",null,[l[0]||(l[0]=e("div",{class:"font-black text-lg leading-none"},"Maimai è°±é¢é”è¯„",-1)),e("div",ct,b(new Date().toLocaleDateString()),1)])]),e("div",ut,b(s.reviews.length)+" Songs ",1)]),e("div",vt,[(v(!0),x(I,null,D(s.reviews,d=>(v(),x("div",{key:d.id,class:"bg-white border-2 border-black rounded-2xl overflow-hidden shadow-[6px_6px_0px_0px_#000000]"},[e("div",bt,[e("div",xt,[e("img",{src:i(M)(d.songId),class:"w-full h-full object-cover",crossorigin:"anonymous"},null,8,mt),e("div",pt,b(d.type),1)]),e("div",gt,[e("div",ft,b(o(d.qualityRating)),1),e("div",null,[e("h3",yt,b(d.title),1),e("div",ht,b(d.level),1)]),e("div",wt,[e("div",_t,[(v(),x(I,null,D(5,g=>p(i(J),{key:g,size:16,class:$(g<=d.starRating?"fill-maimai-yellow text-maimai-yellow":"text-gray-200"),"stroke-width":"3"},null,8,["class"])),64))]),e("div",{class:$(["px-2 py-0.5 text-xs font-black text-white rounded-md border border-black shadow-[1px_1px_0px_0px_#000000]",c(d.qualityRating)])},b(m(d.qualityRating)),3)])])]),e("div",kt,[p(i(ue),{size:24,class:"text-gray-300 absolute top-2 left-2"}),e("div",$t,[e("div",Rt,b(d.oneLiner),1),d.comment?(v(),x("div",At,b(d.comment),1)):j("",!0)])])]))),128))]),l[1]||(l[1]=e("div",{class:"mt-auto text-center"},[e("div",{class:"inline-block px-4 py-1 bg-black text-white text-xs font-bold rounded-full"}," Generated by Maimai Tools ")],-1))]))}},Ct={class:"w-full h-full overflow-auto flex justify-center p-8 bg-gray-200"},St={class:"fixed left-[9999px] top-0 pointer-events-none opacity-0"},It={__name:"ExportCanvas",props:{reviews:{type:Array,required:!0},mode:{type:String,default:"table"}},setup(s,{expose:m}){const o=s,c=ee(),t=h(null),l=h(null),d=h(!1),g=async()=>{const f=o.reviews.map(async w=>{const A=M(w.songId);try{const C=await fetch(A);if(!C.ok)throw new Error("Network response was not ok");await C.blob()}catch{console.warn("Failed to preload image",A)}});await Promise.all(f)};return m({exportImage:async()=>{if(l.value){d.value=!0;try{await g(),await new Promise(A=>setTimeout(A,500));const f=await ne(l.value,{cacheBust:!1,pixelRatio:2,skipAutoScale:!0}),w=document.createElement("a");w.download=`maimai_review_${o.mode}_${Date.now()}.png`,w.href=f,w.click()}catch(f){console.error("Export failed:",f),alert("å›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{d.value=!1}}}}),(f,w)=>(v(),x("div",Ct,[e("div",{ref_key:"canvasRef",ref:t,class:"origin-top scale-75 md:scale-100 transition-transform w-fit shadow-xl"},[s.mode==="table"?(v(),z(Q,{key:0,reviews:s.reviews,username:i(c).profile.nickname||"PLAYER"},null,8,["reviews","username"])):(v(),z(B,{key:1,reviews:s.reviews,username:i(c).profile.nickname||"PLAYER"},null,8,["reviews","username"]))],512),e("div",St,[e("div",{ref_key:"exportRef",ref:l,class:"w-fit"},[s.mode==="table"?(v(),z(Q,{key:0,reviews:s.reviews,username:i(c).profile.nickname||"PLAYER"},null,8,["reviews","username"])):(v(),z(B,{key:1,reviews:s.reviews,username:i(c).profile.nickname||"PLAYER"},null,8,["reviews","username"]))],512)])]))}},Dt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4"},zt={class:"bg-white w-full max-w-md rounded-xl border-2 border-black shadow-[8px_8px_0px_0px_#000000] overflow-hidden flex flex-col max-h-[80vh]"},Lt={class:"p-4 border-b-2 border-black flex justify-between items-center bg-maimai-yellow"},jt={class:"text-xl font-black flex items-center gap-2"},Vt={class:"flex-1 overflow-y-auto p-4 space-y-3"},Mt={class:"flex-1 min-w-0 mr-3"},Et={key:0,class:"flex items-center gap-2"},qt=["onClick"],Ft={class:"font-bold truncate flex items-center gap-2"},Nt={key:0,class:"text-xs bg-blue-600 text-white px-1.5 py-0.5 rounded"},Pt={class:"text-xs text-gray-500 mt-0.5"},Ut={key:0,class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},Tt=["onClick"],Qt=["onClick","disabled"],Bt={class:"p-4 border-t-2 border-black bg-gray-50"},Ot={key:0,class:"flex gap-2"},Yt={__name:"ArchiveManager",props:{isOpen:Boolean},emits:["close"],setup(s,{emit:m}){const o=m,c=H(),t=h(!1),l=h(""),d=h(null),g=h(""),n=()=>{l.value.trim()&&(c.createArchive(l.value),l.value="",t.value=!1)},f=R=>{d.value=R.id,g.value=R.name},w=()=>{g.value.trim()&&c.renameArchive(d.value,g.value),d.value=null},A=R=>{confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå­˜æ¡£å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚")&&c.deleteArchive(R)},C=R=>{c.switchArchive(R)};return(R,_)=>s.isOpen?(v(),x("div",Dt,[e("div",zt,[e("div",Lt,[e("h2",jt,[p(i(G),{size:24}),_[5]||(_[5]=k(" å­˜æ¡£ç®¡ç† ",-1))]),e("button",{onClick:_[0]||(_[0]=a=>o("close")),class:"p-1 hover:bg-black/10 rounded transition-colors"},[p(i(O),{size:24})])]),e("div",Vt,[(v(!0),x(I,null,D(i(c).archives,a=>(v(),x("div",{key:a.id,class:$(["p-3 border-2 rounded-lg flex items-center justify-between group transition-all",i(c).activeArchiveId===a.id?"border-black bg-blue-50 shadow-[2px_2px_0px_0px_#000000]":"border-gray-200 hover:border-gray-400"])},[e("div",Mt,[d.value===a.id?(v(),x("div",Et,[E(e("input",{"onUpdate:modelValue":_[1]||(_[1]=y=>g.value=y),class:"w-full px-2 py-1 text-sm border border-black rounded",onKeyup:T(w,["enter"]),autoFocus:""},null,544),[[q,g.value]]),e("button",{onClick:w,class:"text-green-600 hover:bg-green-100 p-1 rounded"},[p(i(oe),{size:16})])])):(v(),x("div",{key:1,onClick:y=>C(a.id),class:"cursor-pointer"},[e("div",Ft,[k(b(a.name)+" ",1),i(c).activeArchiveId===a.id?(v(),x("span",Nt,"å½“å‰")):j("",!0)]),e("div",Pt,b(a.reviews.length)+" æ¡è¯„ä»· â€¢ "+b(new Date(a.updatedAt).toLocaleDateString()),1)],8,qt))]),d.value!==a.id?(v(),x("div",Ut,[e("button",{onClick:y=>f(a),class:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded",title:"é‡å‘½å"},[p(i(Y),{size:16})],8,Tt),e("button",{onClick:y=>A(a.id),class:$(["p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded",{"cursor-not-allowed opacity-50":i(c).archives.length<=1}]),title:"åˆ é™¤",disabled:i(c).archives.length<=1},[p(i(N),{size:16})],10,Qt)])):j("",!0)],2))),128))]),e("div",Bt,[t.value?(v(),x("div",Ot,[E(e("input",{"onUpdate:modelValue":_[2]||(_[2]=a=>l.value=a),placeholder:"è¾“å…¥å­˜æ¡£åç§°...",class:"flex-1 px-3 py-2 border-2 border-black rounded-lg text-sm",onKeyup:T(n,["enter"]),autoFocus:""},null,544),[[q,l.value]]),e("button",{onClick:n,class:"px-3 py-2 bg-black text-white font-bold rounded-lg text-sm"},"ç¡®å®š"),e("button",{onClick:_[3]||(_[3]=a=>t.value=!1),class:"px-3 py-2 bg-gray-200 font-bold rounded-lg text-sm"},"å–æ¶ˆ")])):(v(),x("button",{key:1,onClick:_[4]||(_[4]=a=>t.value=!0),class:"w-full py-2 border-2 border-dashed border-gray-400 rounded-lg text-gray-500 font-bold hover:border-black hover:text-black hover:bg-white transition-all flex items-center justify-center gap-2"},[p(i(K),{size:18}),_[6]||(_[6]=k(" æ–°å»ºå­˜æ¡£ ",-1))]))])])])):j("",!0)}},Gt={class:"h-[calc(100vh-80px)] flex flex-col gap-4"},Kt={class:"flex items-center justify-between flex-shrink-0 px-4 md:px-0"},Jt={class:"flex items-center gap-4"},Ht={class:"flex gap-2"},Xt={class:"flex-1 flex flex-col lg:flex-row gap-6 overflow-hidden"},Wt={class:"flex-1 bg-white border-2 border-black shadow-[4px_4px_0px_0px_#000000] flex flex-col overflow-hidden rounded-xl"},Zt={class:"p-4 border-b-2 border-black bg-gray-50 flex justify-between items-center"},es={class:"font-bold text-lg"},ts={class:"flex-1 overflow-y-auto p-4"},ss={key:0,class:"h-full flex flex-col items-center justify-center text-gray-400"},ls={class:"flex-1 bg-gray-100 border-2 border-black shadow-[4px_4px_0px_0px_#000000] flex flex-col overflow-hidden rounded-xl"},os={class:"p-4 border-b-2 border-black bg-white flex justify-between items-center"},as={class:"flex bg-gray-100 rounded-lg p-1 border border-black"},ns={class:"flex-1 overflow-hidden bg-gray-200 relative"},is={class:"p-4 border-t-2 border-black bg-white"},rs=["disabled"],fs={__name:"ReviewView",setup(s){const m=le(),o=H(),c=h([]),t=h(!1),l=h(!1),d=h(!1),g=h(null),n=h(null),f=h({}),w=h(null);te(async()=>{try{c.value=await se()}catch(u){console.error("Failed to load music data",u)}});const A=u=>{g.value=u,n.value=null,f.value={},t.value=!1,l.value=!0},C=u=>{g.value={id:u.songId,title:u.title,cover:u.cover,type:u.type,level:u.level,level_index:u.levelIndex},n.value=u.id,f.value={starRating:u.starRating,qualityRating:u.qualityRating,oneLiner:u.oneLiner,comment:u.comment},l.value=!0},R=u=>{n.value?o.updateReview(n.value,u):o.addReview(u),l.value=!1,g.value=null,n.value=null},_=u=>{confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„ä»·å—ï¼Ÿ")&&o.removeReview(u)},a=()=>{confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è¯„ä»·å—ï¼Ÿ")&&o.clearReviews()},y=()=>{w.value&&w.value.exportImage()};return(u,r)=>{var L;return v(),x("div",Gt,[e("div",Kt,[e("div",Jt,[e("button",{onClick:r[0]||(r[0]=S=>i(m).back()),class:"flex items-center gap-1 text-gray-500 font-bold hover:text-black transition-colors"},[p(i(re),{size:20}),r[9]||(r[9]=k(" è¿”å› ",-1))]),r[10]||(r[10]=e("h1",{class:"text-xl lg:text-2xl font-black"},"ä¸€å¥è¯è¯„ä»·è°±é¢",-1)),e("button",{onClick:r[1]||(r[1]=S=>d.value=!0),class:"flex items-center gap-2 px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-sm font-bold text-gray-700 transition-colors border border-gray-300"},[p(i(G),{size:16}),k(" "+b(((L=i(o).currentArchive)==null?void 0:L.name)||"é»˜è®¤å­˜æ¡£"),1)])]),e("div",Ht,[e("button",{onClick:r[2]||(r[2]=S=>t.value=!0),class:"flex items-center gap-2 px-4 py-2 text-sm font-bold bg-maimai-blue text-white border-2 border-black shadow-[4px_4px_0px_0px_#000000] hover:translate-x-[2px] hover:translate-y-[2px] hover:shadow-[2px_2px_0px_0px_#000000] active:translate-x-[4px] active:translate-y-[4px] active:shadow-none transition-all"},[p(i(K),{size:18}),r[11]||(r[11]=k(" æ·»åŠ è¯„ä»· ",-1))])])]),e("div",Xt,[e("div",Wt,[e("div",Zt,[e("h2",es,"è¯„ä»·åˆ—è¡¨ ("+b(i(o).reviews.length)+")",1),e("button",{onClick:a,class:"text-red-500 text-sm font-bold hover:underline flex items-center gap-1"},[p(i(N),{size:14}),r[12]||(r[12]=k(" æ¸…ç©º ",-1))])]),e("div",ts,[i(o).reviews.length===0?(v(),x("div",ss,[r[13]||(r[13]=e("p",null,"è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•è¯„ä»·",-1)),e("button",{onClick:r[3]||(r[3]=S=>t.value=!0),class:"mt-2 text-maimai-blue font-bold hover:underline"},"ç‚¹å‡»æ·»åŠ ç¬¬ä¸€é¦–")])):(v(),z(Ye,{key:1,reviews:i(o).reviews,onEdit:C,onDelete:_},null,8,["reviews"]))])]),e("div",ls,[e("div",os,[r[14]||(r[14]=e("h2",{class:"font-bold text-lg"},"é¢„è§ˆ & å¯¼å‡º",-1)),e("div",as,[e("button",{onClick:r[4]||(r[4]=S=>i(o).currentMode="table"),class:$(["p-1.5 rounded transition-colors",i(o).currentMode==="table"?"bg-white shadow-sm border border-black":"text-gray-500 hover:text-black"]),title:"è¡¨æ ¼æ¨¡å¼"},[p(i(ce),{size:18})],2),e("button",{onClick:r[5]||(r[5]=S=>i(o).currentMode="card"),class:$(["p-1.5 rounded transition-colors",i(o).currentMode==="card"?"bg-white shadow-sm border border-black":"text-gray-500 hover:text-black"]),title:"å¡ç‰‡æ¨¡å¼"},[p(i(de),{size:18})],2)])]),e("div",ns,[p(It,{ref_key:"exportCanvasRef",ref:w,reviews:i(o).reviews,mode:i(o).currentMode},null,8,["reviews","mode"])]),e("div",is,[e("button",{onClick:y,class:"w-full btn-base bg-maimai-green text-white py-3 flex items-center justify-center gap-2 font-black text-lg",disabled:i(o).reviews.length===0},[p(i(ie),{size:20}),r[15]||(r[15]=k(" å¯¼å‡ºå›¾ç‰‡ ",-1))],8,rs)])])]),p(ae,{"is-open":t.value,"music-data":c.value,onClose:r[6]||(r[6]=S=>t.value=!1),onSelect:A},null,8,["is-open","music-data"]),l.value?(v(),z(Le,{key:0,song:g.value,"initial-data":f.value,onSave:R,onCancel:r[7]||(r[7]=S=>l.value=!1)},null,8,["song","initial-data"])):j("",!0),p(Yt,{"is-open":d.value,onClose:r[8]||(r[8]=S=>d.value=!1)},null,8,["is-open"])])}}};export{fs as default};
