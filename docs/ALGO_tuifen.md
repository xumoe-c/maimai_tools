# 推分建议功能规划与算法研究

## 1. 功能概述

本功能旨在根据玩家的 B50 成绩、历史游玩记录以及全服统计数据，为玩家提供个性化的乐曲推荐，帮助玩家高效提升 DX Rating。

## 2. 数据基础

本功能将综合利用以下三个数据源：

### 2.1 基础元数据 (`musicData.json`)

- **用途**: 提供乐曲的基本信息（标题、封面、分类）、官方定数 (DS) 以及新旧版本标识 (`is_new`)。
- **关键字段**: `id`, `title`, `ds`, `basic_info.is_new`.

### 2.2 全服统计数据 (`chart_stats.json`)

- **用途**: 提供比官方定数更精准的“拟合定数” (`fit_diff`) 和谱面平均达成率 (`avg`)。
- **价值**:
  - **拟合定数**: 修正了官方定数的偏差（诈称/逆诈称），能更准确地反映谱面实际难度。
  - **平均达成率**: 用于识别“甜品谱”（容易拿高分的谱面）或“地雷谱”。
- **数据结构**:
  ```json
  "100363": [
      { "cnt": 1314, "diff": "13?", "fit_diff": 13.37, "avg": 96.87, ... }, // Master
      ...
  ]
  ```

### 2.3 用户数据 (`userStore`)

- **用途**: 提供玩家当前的 B15 (New) 和 B35 (Old) 列表，以及所有历史成绩。
- **关键指标**:
  - **Current Rating**: 玩家当前总分。
  - **B15/B35 Min**: 当前 B50 列表的守门员（最低）分数。
  - **B15/B35 Avg**: 玩家在新/旧曲目上的平均水平。

## 3. 核心算法逻辑

### 3.1 玩家能力画像 (User Capability Profiling)

在进行推荐前，首先需要分析玩家在不同定数区间的表现。

- **算法**: 遍历玩家所有成绩，计算各整数定数区间（如 12.0-12.9, 13.0-13.9）的平均达成率。
- **用途**: 用于预测玩家在未游玩曲目上的大概达成率。

### 3.2 推荐策略 (Recommendation Strategies)

我们将提供多种维度的推荐策略，以满足不同阶段玩家的需求：

#### 策略 A: 临门一脚 (Score Attack)

*目标：提升已游玩曲目的达成率，跨越评价档位（如 S -> SS）。*

- **筛选条件**:
  - 玩家已游玩。
  - 达成率落在关键阈值附近（例如 96.5%~96.9%, 98.5%~98.9%, 99.0%~99.5%）。
- **排序权重**: `(目标档位Rating - 当前实际Rating)` 降序。
- **推荐语**: "距离 SSS 仅差 0.2%，提升后 Rating +5"。

#### 策略 B: 潜力新曲/旧曲 (Potential Gem)

*目标：填补 B15 或 B35 的空缺，或替换底分曲目。*

- **筛选条件**:
  - 玩家未游玩，或成绩远低于预期。
  - 区分 `is_new` 属性，分别针对 B15 和 B35 池子。
  - `fit_diff` (拟合定数) 处于玩家的主力定数区间 (B15/B35 Avg ± 0.5)。
- **预测模型**:
  - `预测达成率` = 参考全服 `avg` 及玩家在同级别谱面的平均表现。
  - `预测 Rating` = 基于 `fit_diff` 和 `预测达成率` 计算。
- **排序权重**: `(预测 Rating - 当前 B15/B35 Min)` 降序。
- **推荐语**: "适合你的 13+ 练习曲，预计 Rating 280"。

#### 策略 C: 甜品挖掘 (Easy High Score)

*目标：利用统计数据，推荐“虚高”或容易拿分的曲目。*

- **筛选条件**:
  - `fit_diff` < `official_ds` (官方定数虚高) —— *注：这种情况较少，通常反过来用 fit_diff 找实际简单的歌*。
  - 或者：在同 `fit_diff` 水平下，全服 `avg` 显著偏高的曲目。
- **排序权重**: 全服 `avg` 降序。
- **推荐语**: "全服平均 99.5%，极易 SSS"。

## 4. 界面规划 (UI/UX)

### 4.1 入口

- 在侧边栏 (AppSidebar) 增加 "推分建议 (Recommendations)" 入口。

### 4.2 页面布局

- **概览卡片**: 显示 B15/B35 的平均分、最低分，以及“下个目标 Rating”。
- **多标签页 (Tabs)**:
  - **[冲分]**: 对应策略 A。
  - **[新曲推荐]**: 对应策略 B (New)。
  - **[旧曲推荐]**: 对应策略 B (Old)。
  - **[甜品]**: 对应策略 C。
- **列表项设计**:
  - 左侧：封面 + 曲名 + 难度标。
  - 中间：当前达成率 -> 目标达成率。
  - 右侧：预计 Rating 提升值 (高亮显示)。
  - 底部小字：推荐理由（如“拟合定数 13.5，低于官方定数 13.7”）。

## 5. 开发路线图

1. **代码重构**: 将 `B50View.vue` 中的 `getRating` 函数提取为通用的工具函数 `src/utils/rating.js`，以便复用。
2. **数据层**: 编写 `src/stores/recommendation.js`，负责加载 `chart_stats.json` 并实现上述筛选算法。
3. **计算层**: 封装 Rating 计算公式（支持传入 fit_diff）。
4. **UI 层**: 开发 `RecommendationView.vue` 及相关组件。
